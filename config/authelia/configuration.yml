# Authelia Configuration for CORTEX GRC
# Lightweight SSO/2FA replacement for Keycloak

server:
  host: 0.0.0.0
  port: 9091

log:
  level: info
  format: json

theme: auto

jwt_secret: a_very_long_random_secret_key_min_20_chars

default_2fa_method: totp

authentication_backend:
  file:
    path: /config/users_database.yml
    password:
      algorithm: argon2id
      iterations: 3
      key_length: 32
      salt_length: 16
      memory: 65536
      parallelism: 4

access_control:
  default_policy: deny
  rules:
    # Public endpoints
    - domain: '*.cortex.local'
      resources:
        - '^/api/health$'
        - '^/api/v1/auth/login$'
        - '^/api/v1/auth/register$'
      policy: bypass

    # Protected API
    - domain: '*.cortex.local'
      resources:
        - '^/api/.*$'
      policy: one_factor

    # Admin panel requires 2FA
    - domain: 'admin.cortex.local'
      policy: two_factor

    # Default protected
    - domain: '*.cortex.local'
      policy: one_factor

session:
  name: cortex_session
  secret: another_long_random_secret_key
  expiration: 12h
  inactivity: 45m
  remember_me_duration: 1M
  domain: cortex.local
  redis:
    host: redis
    port: 6379
    database_index: 2

regulation:
  max_retries: 3
  find_time: 2m
  ban_time: 5m

storage:
  encryption_key: yet_another_32_char_random_key!!
  local:
    path: /data/db.sqlite3

notifier:
  smtp:
    host: mailpit
    port: 1025
    sender: "CORTEX GRC <noreply@cortex.local>"
    disable_require_tls: true
    disable_starttls: true

totp:
  issuer: cortex.grc
  period: 30
  skew: 1
