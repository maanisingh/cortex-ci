"""
SME Document Templates - Phase 10: Financial and Accounting Documents
Russian accounting and financial document templates

Document Types:
1. Invoice (Счёт на оплату)
2. Payment Order (Платёжное поручение)
3. Act of Completed Works (Акт выполненных работ)
4. Goods Receipt Act (Товарная накладная ТОРГ-12)
5. Invoice-Factura (Счёт-фактура)
6. Universal Transfer Document (УПД)
7. Cash Receipt Order (Приходный кассовый ордер КО-1)
8. Cash Disbursement Order (Расходный кассовый ордер КО-2)
9. Advance Report (Авансовый отчёт АО-1)
10. Power of Attorney for Goods (Доверенность М-2)
11. Act of Reconciliation (Акт сверки)
12. Debt Write-off Act (Акт списания задолженности)
13. Loan Agreement Internal (Договор займа внутренний)
14. Dividend Resolution (Решение о выплате дивидендов)
15. Accounting Policy (Учётная политика)
16. Inventory Act (Акт инвентаризации)
17. Fixed Asset Acceptance Act (Акт ОС-1)
18. Depreciation Schedule (График амортизации)
"""

from typing import Dict, Any, List, Optional
from datetime import date, datetime
from decimal import Decimal
from enum import Enum
from pydantic import BaseModel


class FinancialDocType(str, Enum):
    INVOICE = "invoice"
    PAYMENT_ORDER = "payment_order"
    ACT_COMPLETED_WORKS = "act_completed_works"
    TORG_12 = "torg_12"
    INVOICE_FACTURA = "invoice_factura"
    UPD = "upd"
    CASH_RECEIPT = "cash_receipt"
    CASH_DISBURSEMENT = "cash_disbursement"
    ADVANCE_REPORT = "advance_report"
    POA_GOODS = "poa_goods"
    RECONCILIATION_ACT = "reconciliation_act"
    DEBT_WRITEOFF = "debt_writeoff"
    INTERNAL_LOAN = "internal_loan"
    DIVIDEND_RESOLUTION = "dividend_resolution"
    ACCOUNTING_POLICY = "accounting_policy"
    INVENTORY_ACT = "inventory_act"
    FIXED_ASSET_ACT = "fixed_asset_act"
    DEPRECIATION_SCHEDULE = "depreciation_schedule"


class VATRate(str, Enum):
    VAT_20 = "20"
    VAT_10 = "10"
    VAT_0 = "0"
    NO_VAT = "без НДС"


# =============================================================================
# Template 1: Invoice (Счёт на оплату)
# =============================================================================

INVOICE_TEMPLATE = """
                              СЧЁТ № {invoice_number}
                              от «{day}» {month} {year} г.

ПОСТАВЩИК: {supplier_name}
ИНН: {supplier_inn}  КПП: {supplier_kpp}
Адрес: {supplier_address}
Р/с: {supplier_account}
Банк: {supplier_bank}
БИК: {supplier_bik}  К/с: {supplier_corr_account}

ПОКУПАТЕЛЬ: {buyer_name}
ИНН: {buyer_inn}  КПП: {buyer_kpp}
Адрес: {buyer_address}

Основание: {basis_document}

┌────┬─────────────────────────────────────┬─────────┬────────┬─────────────┐
│ №  │ Наименование товара (работ, услуг) │ Кол-во  │  Цена  │   Сумма     │
│п/п │                                     │         │        │             │
├────┼─────────────────────────────────────┼─────────┼────────┼─────────────┤
{items_table}
├────┴─────────────────────────────────────┴─────────┴────────┼─────────────┤
│ Итого:                                                      │ {subtotal}  │
├─────────────────────────────────────────────────────────────┼─────────────┤
│ В том числе НДС ({vat_rate}%):                              │ {vat_amount}│
├─────────────────────────────────────────────────────────────┼─────────────┤
│ ВСЕГО К ОПЛАТЕ:                                             │ {total}     │
└─────────────────────────────────────────────────────────────┴─────────────┘

Всего наименований: {items_count}, на сумму: {total} руб.
{total_words}

Срок оплаты: {payment_due_date}
Условия оплаты: {payment_terms}

Руководитель _________________ / {director_name} /

Главный бухгалтер _________________ / {accountant_name} /

М.П.

Счёт действителен в течение {validity_days} дней.
"""


# =============================================================================
# Template 2: Act of Completed Works (Акт выполненных работ)
# =============================================================================

ACT_COMPLETED_WORKS_TEMPLATE = """
                    АКТ № {act_number}
                    сдачи-приёмки выполненных работ (оказанных услуг)

г. {city}                                           «{day}» {month} {year} г.

{executor_name}, именуемое в дальнейшем «Исполнитель», в лице {executor_representative},
действующего на основании {executor_basis}, с одной стороны, и

{customer_name}, именуемое в дальнейшем «Заказчик», в лице {customer_representative},
действующего на основании {customer_basis}, с другой стороны,

составили настоящий Акт о нижеследующем:

1. Исполнитель выполнил, а Заказчик принял следующие работы (услуги)
   по Договору № {contract_number} от {contract_date}:

┌────┬─────────────────────────────────────┬─────────┬────────┬─────────────┐
│ №  │ Наименование работ (услуг)          │ Ед.изм. │ Кол-во │   Сумма     │
│п/п │                                     │         │        │             │
├────┼─────────────────────────────────────┼─────────┼────────┼─────────────┤
{works_table}
├────┴─────────────────────────────────────┴─────────┴────────┼─────────────┤
│ Итого:                                                      │ {subtotal}  │
├─────────────────────────────────────────────────────────────┼─────────────┤
│ НДС ({vat_rate}%):                                          │ {vat_amount}│
├─────────────────────────────────────────────────────────────┼─────────────┤
│ ВСЕГО:                                                      │ {total}     │
└─────────────────────────────────────────────────────────────┴─────────────┘

Всего оказано услуг (выполнено работ) на сумму: {total} ({total_words}) рублей,
{vat_clause}.

2. Работы (услуги) выполнены в полном объёме и в установленные сроки.
   Качество работ (услуг) соответствует условиям Договора.

3. Заказчик претензий по объёму, качеству и срокам выполнения работ
   (оказания услуг) не имеет.

4. Настоящий Акт составлен в двух экземплярах, по одному для каждой Стороны.

ИСПОЛНИТЕЛЬ:                              ЗАКАЗЧИК:
{executor_name}                            {customer_name}
ИНН: {executor_inn}                        ИНН: {customer_inn}
Адрес: {executor_address}                  Адрес: {customer_address}

Сдал: _____________ / {executor_signatory} /   Принял: _____________ / {customer_signatory} /

М.П.                                       М.П.
"""


# =============================================================================
# Template 3: Goods Receipt (ТОРГ-12)
# =============================================================================

TORG_12_TEMPLATE = """
                                                            Унифицированная форма № ТОРГ-12
                                                            Утверждена постановлением Госкомстата
                                                            России от 25.12.98 № 132

                                        ТОВАРНАЯ НАКЛАДНАЯ
                            Номер документа: {doc_number}    Дата составления: {doc_date}

Грузоотправитель: {shipper_name}
Адрес: {shipper_address}
ИНН/КПП: {shipper_inn}/{shipper_kpp}
Р/с: {shipper_account}  Банк: {shipper_bank}  БИК: {shipper_bik}

Грузополучатель: {consignee_name}
Адрес: {consignee_address}
ИНН/КПП: {consignee_inn}/{consignee_kpp}

Поставщик: {supplier_name}
Адрес: {supplier_address}
ИНН/КПП: {supplier_inn}/{supplier_kpp}

Плательщик: {payer_name}
Адрес: {payer_address}
ИНН/КПП: {payer_inn}/{payer_kpp}

Основание: {basis_document}

┌────┬──────────────┬───────┬───────┬────────┬────────┬───────┬────────┬───────┐
│ №  │Наименование  │Ед.изм.│Кол-во │Цена без│Сумма   │Ставка │Сумма   │ Всего │
│п/п │товара        │       │       │ НДС    │без НДС │ НДС   │ НДС    │с НДС  │
├────┼──────────────┼───────┼───────┼────────┼────────┼───────┼────────┼───────┤
{items_table}
├────┴──────────────┴───────┴───────┴────────┼────────┼───────┼────────┼───────┤
│ Итого:                                     │{subtotal}│     │{vat_total}│{total}│
└────────────────────────────────────────────┴────────┴───────┴────────┴───────┘

Товарная накладная имеет приложение на _____ листах.
Всего мест ______. Масса груза (нетто) ______ кг. Масса груза (брутто) ______ кг.
Всего наименований {items_count}, на сумму {total} руб.

                              ОТПУСК ГРУЗА РАЗРЕШИЛ

Директор: _____________________ / {director_name} /    «___» __________ 20__ г.

Главный бухгалтер: _____________________ / {accountant_name} /

Отпуск груза произвёл: _____________________ / {releaser_name} /   «___» __________ 20__ г.

М.П.

                              ГРУЗ ПРИНЯЛ

Груз получил: _____________________ / {receiver_name} /   «___» __________ 20__ г.

Груз принял: _____________________ / {acceptor_name} /   «___» __________ 20__ г.

По доверенности № ______ от «___» __________ 20__ г., выданной {poa_issuer}

М.П.
"""


# =============================================================================
# Template 4: Invoice-Factura (Счёт-фактура)
# =============================================================================

INVOICE_FACTURA_TEMPLATE = """
                                СЧЁТ-ФАКТУРА № {sf_number} от {sf_date}
                                ИСПРАВЛЕНИЕ № ____ от «__» _______ 20__ г.

Продавец: {seller_name}
Адрес: {seller_address}
ИНН/КПП продавца: {seller_inn}/{seller_kpp}

Грузоотправитель и его адрес: {shipper_info}
Грузополучатель и его адрес: {consignee_info}

К платёжно-расчётному документу: № {payment_doc_number} от {payment_doc_date}

Покупатель: {buyer_name}
Адрес: {buyer_address}
ИНН/КПП покупателя: {buyer_inn}/{buyer_kpp}

Валюта: наименование, код: Российский рубль, 643

┌────┬──────────────┬────────┬───────┬───────┬────────┬───────┬────────┬────────┬─────────┬────────┐
│ №  │Наименование  │Код     │Единица│Кол-во │Цена за │Стоим. │В т.ч.  │Налог.  │Стоим.   │Страна  │
│п/п │товара        │вида    │изм.   │       │единицу │без    │акциз   │ставка  │с налогом│происх. │
│    │              │товара  │код|наим│       │        │налога │        │        │         │код|наим│
├────┼──────────────┼────────┼───────┼───────┼────────┼───────┼────────┼────────┼─────────┼────────┤
{items_table}
├────┴──────────────┴────────┴───────┴───────┴────────┼───────┼────────┼────────┼─────────┼────────┤
│ Всего к оплате:                                     │{subtotal}│      │{vat}   │{total}  │   X    │
└─────────────────────────────────────────────────────┴───────┴────────┴────────┴─────────┴────────┘

Руководитель организации
(или иное уполномоченное лицо) _________________ / {director_name} /

Главный бухгалтер
(или иное уполномоченное лицо) _________________ / {accountant_name} /

Индивидуальный предприниматель _________________
(реквизиты свидетельства о государственной регистрации)
"""


# =============================================================================
# Template 5: Universal Transfer Document (УПД)
# =============================================================================

UPD_TEMPLATE = """
                        УНИВЕРСАЛЬНЫЙ ПЕРЕДАТОЧНЫЙ ДОКУМЕНТ
                        Статус: {upd_status}

    ┌──────────────────────────────────────────────────────────────────────────┐
    │                         СЧЁТ-ФАКТУРА № {sf_number} от {sf_date}          │
    │                    ИСПРАВЛЕНИЕ № ____ от «__» _________ 20__ г.          │
    └──────────────────────────────────────────────────────────────────────────┘

(1) Продавец: {seller_name}
(2) Адрес: {seller_address}
(2а) ИНН/КПП продавца: {seller_inn}/{seller_kpp}
(3) Грузоотправитель: {shipper_info}
(4) Грузополучатель: {consignee_info}
(5) К платёжно-расчётному документу: № {payment_doc_number} от {payment_doc_date}
(6) Покупатель: {buyer_name}
(6а) Адрес: {buyer_address}
(6б) ИНН/КПП покупателя: {buyer_inn}/{buyer_kpp}
(7) Валюта: Российский рубль, код 643

┌────┬──────────────┬────────┬───────┬───────┬────────┬───────┬────────┬────────┬─────────┐
│ №  │Наименование  │Код     │Единица│Кол-во │Цена за │Стоим. │Налог.  │Сумма   │Стоим.   │
│п/п │товара (работ,│вида    │измер. │       │единицу │без    │ставка  │налога  │с налогом│
│    │услуг)        │товара  │       │       │        │налога │        │        │         │
├────┼──────────────┼────────┼───────┼───────┼────────┼───────┼────────┼────────┼─────────┤
{items_table}
├────┴──────────────┴────────┴───────┴───────┴────────┼───────┼────────┼────────┼─────────┤
│ Всего к оплате:                                     │{subtotal}│      │{vat}   │{total}  │
└─────────────────────────────────────────────────────┴───────┴────────┴────────┴─────────┘

    ┌──────────────────────────────────────────────────────────────────────────┐
    │                    ДОКУМЕНТ ОБ ОТГРУЗКЕ (ПЕРЕДАЧЕ)                        │
    └──────────────────────────────────────────────────────────────────────────┘

(8) Основание передачи (сдачи)/получения (приёмки): {basis_document}
(9) Данные о транспортировке и грузе: {transport_info}

[10] Товар (груз) передал / услуги, результаты работ сдал:
Должность: {releaser_position}
Подпись: ___________________ / {releaser_name} /
Дата отгрузки, передачи: {release_date}

[11] Дата получения (приёмки): {receipt_date}

[15] Товар (груз) получил / услуги, результаты работ принял:
Должность: {receiver_position}
Подпись: ___________________ / {receiver_name} /

[12] Иные сведения об отгрузке: {additional_info}

[13] Ответственный за правильность оформления:
Должность: {responsible_position}
Подпись: ___________________ / {responsible_name} /
Наименование экономического субъекта: {entity_name}

М.П.                                                  М.П.
"""


# =============================================================================
# Template 6: Cash Receipt Order (Приходный кассовый ордер КО-1)
# =============================================================================

CASH_RECEIPT_ORDER_TEMPLATE = """
                                                    Унифицированная форма № КО-1
                                                    Утв. пост. Госкомстата России
                                                    от 18.08.98 № 88

{organization_name}
ОКПО: {okpo}

                          ПРИХОДНЫЙ КАССОВЫЙ ОРДЕР № {pko_number}

                          от «{day}» {month} {year} г.

┌──────────────────┬─────────────────┬──────────────────────────────────────────┐
│ Дебет            │ Кредит          │ Сумма, руб. коп.                         │
├─────┬────────────┼────────┬────────┼────────────────────────────────────────────
│код  │код аналит. │код     │код     │                                          │
│стр. │учёта       │стр.    │аналит. │                                          │
│учёта│            │учёта   │учёта   │                                          │
├─────┼────────────┼────────┼────────┼──────────────────────────────────────────┤
│ 50  │            │ {cr_acc}│       │ {amount}                                 │
└─────┴────────────┴────────┴────────┴──────────────────────────────────────────┘

Принято от: {received_from}

Основание: {basis}

Сумма: {amount_words}
в том числе НДС: {vat_info}

Приложение: {attachments}

Главный бухгалтер _____________________ / {accountant_name} /

Получил кассир _____________________ / {cashier_name} /

- - - - - - - - - - - - - - - - линия отреза - - - - - - - - - - - - - - - -

                                  КВИТАНЦИЯ

                         к приходному кассовому ордеру № {pko_number}
                         от «{day}» {month} {year} г.

Принято от: {received_from}

Основание: {basis}

Сумма: {amount_words}
в том числе НДС: {vat_info}

М.П.

Главный бухгалтер _____________________ / {accountant_name} /

Кассир _____________________ / {cashier_name} /
"""


# =============================================================================
# Template 7: Cash Disbursement Order (Расходный кассовый ордер КО-2)
# =============================================================================

CASH_DISBURSEMENT_ORDER_TEMPLATE = """
                                                    Унифицированная форма № КО-2
                                                    Утв. пост. Госкомстата России
                                                    от 18.08.98 № 88

{organization_name}
ОКПО: {okpo}

                          РАСХОДНЫЙ КАССОВЫЙ ОРДЕР № {rko_number}

                          от «{day}» {month} {year} г.

┌──────────────────┬─────────────────┬────────────────────────────────────────┐
│ Дебет            │ Кредит          │ Сумма, руб. коп.                       │
├─────┬────────────┼────────┬────────┼────────────────────────────────────────┤
│код  │код         │код     │код     │                                        │
│стр. │аналит.     │стр.    │аналит. │                                        │
│учёта│учёта       │учёта   │учёта   │                                        │
├─────┼────────────┼────────┼────────┼────────────────────────────────────────┤
│{db_acc}│         │ 50     │        │ {amount}                               │
└─────┴────────────┴────────┴────────┴────────────────────────────────────────┘

Выдать: {recipient}

Основание: {basis}

Сумма: {amount_words}
в том числе НДС: {vat_info}

Приложение: {attachments}

Руководитель организации _____________________ / {director_name} /

Главный бухгалтер _____________________ / {accountant_name} /

Получил: {amount_words}
«___» __________ 20__ г.           Подпись: ___________________

По документу: {identity_document}

Выдал кассир _____________________ / {cashier_name} /
"""


# =============================================================================
# Template 8: Advance Report (Авансовый отчёт АО-1)
# =============================================================================

ADVANCE_REPORT_TEMPLATE = """
                                                    Унифицированная форма № АО-1
                                                    Утв. пост. Госкомстата России
                                                    от 01.08.2001 № 55

{organization_name}
ОКПО: {okpo}

                              АВАНСОВЫЙ ОТЧЁТ № {report_number}
                              от «{day}» {month} {year} г.

Структурное подразделение: {department}

Подотчётное лицо: {employee_name}
Табельный номер: {employee_id}
Должность: {employee_position}

Назначение аванса: {advance_purpose}

┌─────────────────────────────────────────────────────────────────────────────┐
│                              ЛИЦЕВАЯ СТОРОНА                                 │
├─────────────────────────────────────────────────────────────────────────────┤
│ Остаток предыдущего аванса:         │ перерасход _______ │ остаток _______ │
│ Получено из кассы:                  │ {received_amount}                     │
│ Израсходовано:                      │ {spent_amount}                        │
│ Остаток:                            │ {balance_due}                         │
│ Перерасход:                         │ {overspent}                           │
└─────────────────────────────────────────────────────────────────────────────┘

Приложение: {attachments_count} документов на {sheets_count} листах

Отчёт проверен. К утверждению в сумме: {approved_amount} руб.

Бухгалтер _____________________ / {accountant_name} /

УТВЕРЖДЕНО в сумме {approved_amount} ({approved_amount_words}) рублей

Руководитель _____________________ / {director_name} /    «___» __________ 20__ г.

┌─────────────────────────────────────────────────────────────────────────────┐
│                              ОБОРОТНАЯ СТОРОНА                               │
├────┬─────────────┬────────────┬─────────┬────────┬───────┬─────────────────┤
│ №  │ Документ    │Наименование│Сумма    │Дебет   │Кредит │Примечание       │
│п/п │дата | номер │расхода     │расхода  │счёт    │счёт   │                 │
├────┼─────────────┼────────────┼─────────┼────────┼───────┼─────────────────┤
{expenses_table}
├────┴─────────────┴────────────┼─────────┼────────┴───────┴─────────────────┤
│ Итого:                        │{total}  │                                   │
└───────────────────────────────┴─────────┴───────────────────────────────────┘

Подотчётное лицо _____________________ / {employee_name} /
"""


# =============================================================================
# Template 9: Power of Attorney for Goods (Доверенность М-2)
# =============================================================================

POA_GOODS_TEMPLATE = """
                                                    Унифицированная форма № М-2
                                                    Утв. пост. Госкомстата России
                                                    от 30.10.97 № 71а

{organization_name}
ОКПО: {okpo}

                                  ДОВЕРЕННОСТЬ № {poa_number}

Дата выдачи: «{day}» {month} {year} г.
Срок действия: до «{expiry_day}» {expiry_month} {expiry_year} г.

Наименование потребителя: {consumer_name}
Адрес: {consumer_address}
Плательщик: {payer_name}
Адрес: {payer_address}
Счёт в банке: {payer_account}

Доверенность выдана: {employee_name}
Должность: {employee_position}
Паспорт: серия {passport_series} № {passport_number}
выдан {passport_issued_by} «{passport_date}»

На получение от: {supplier_name}

материальных ценностей по: {basis_document}

┌────┬────────────────────────────────────────────┬─────────────────────────────┐
│ №  │ Наименование материальных ценностей        │ Единица измерения │ Кол-во │
│п/п │                                            │                   │        │
├────┼────────────────────────────────────────────┼───────────────────┼────────┤
{items_table}
└────┴────────────────────────────────────────────┴───────────────────┴────────┘

Подпись лица, получившего доверенность _____________________ удостоверяем.

Руководитель _____________________ / {director_name} /

Главный бухгалтер _____________________ / {accountant_name} /

М.П.

Образец подписи лица, получившего доверенность: _____________________

- - - - - - - - - - - - - - - - линия отреза - - - - - - - - - - - - - - - -

                                  КОРЕШОК ДОВЕРЕННОСТИ № {poa_number}

Дата выдачи: «{day}» {month} {year} г.
Срок действия: до «{expiry_day}» {expiry_month} {expiry_year} г.
Должность и ФИО: {employee_position} {employee_name}
Поставщик: {supplier_name}
Документ: {basis_document}
Дата исполнения: _______________
Доверенность получил: _____________________

Отметка о выполнении: ___________________________________________________
"""


# =============================================================================
# Template 10: Act of Reconciliation (Акт сверки)
# =============================================================================

RECONCILIATION_ACT_TEMPLATE = """
                              АКТ СВЕРКИ
                 взаимных расчётов по состоянию на {reconciliation_date}

между {party1_name} и {party2_name}

Мы, нижеподписавшиеся:
от {party1_name} — {party1_representative}, действующий на основании {party1_basis},
от {party2_name} — {party2_representative}, действующий на основании {party2_basis},

составили настоящий Акт сверки взаимных расчётов за период
с {period_start} по {period_end}:

                         По данным {party1_short_name}

┌──────────────┬───────────────────────────────┬────────────────────────────────┐
│    Дата      │            Дебет              │            Кредит              │
│              │  (мы должны контрагенту)      │  (контрагент должен нам)       │
├──────────────┼───────────────────────────────┼────────────────────────────────┤
│ Сальдо на    │ {opening_debit_1}             │ {opening_credit_1}             │
│ {period_start}│                              │                                │
├──────────────┼───────────────────────────────┼────────────────────────────────┤
{transactions_table_1}
├──────────────┼───────────────────────────────┼────────────────────────────────┤
│ Обороты:     │ {turnover_debit_1}            │ {turnover_credit_1}            │
├──────────────┼───────────────────────────────┼────────────────────────────────┤
│ Сальдо на    │ {closing_debit_1}             │ {closing_credit_1}             │
│ {period_end} │                               │                                │
└──────────────┴───────────────────────────────┴────────────────────────────────┘

                         По данным {party2_short_name}

┌──────────────┬───────────────────────────────┬────────────────────────────────┐
│    Дата      │            Дебет              │            Кредит              │
├──────────────┼───────────────────────────────┼────────────────────────────────┤
│ Сальдо на    │ {opening_debit_2}             │ {opening_credit_2}             │
│ {period_start}│                              │                                │
├──────────────┼───────────────────────────────┼────────────────────────────────┤
{transactions_table_2}
├──────────────┼───────────────────────────────┼────────────────────────────────┤
│ Обороты:     │ {turnover_debit_2}            │ {turnover_credit_2}            │
├──────────────┼───────────────────────────────┼────────────────────────────────┤
│ Сальдо на    │ {closing_debit_2}             │ {closing_credit_2}             │
│ {period_end} │                               │                                │
└──────────────┴───────────────────────────────┴────────────────────────────────┘

Расхождения: {discrepancies}

По состоянию на {reconciliation_date}:
{balance_statement}

{party1_name}                              {party2_name}
_____________________ / {party1_signatory} /   _____________________ / {party2_signatory} /

М.П.                                       М.П.

Дата: «___» __________ 20__ г.             Дата: «___» __________ 20__ г.
"""


# =============================================================================
# Template 11-18: Remaining Financial Templates (Shorter versions)
# =============================================================================

DEBT_WRITEOFF_ACT_TEMPLATE = """
                         АКТ СПИСАНИЯ ЗАДОЛЖЕННОСТИ № {act_number}

г. {city}                                           «{day}» {month} {year} г.

{organization_name}

Комиссия в составе:
Председатель: {chairman_name}, {chairman_position}
Члены комиссии: {members_list}

провела проверку дебиторской/кредиторской задолженности и установила:

1. Должник: {debtor_name}
   ИНН: {debtor_inn}
   Основание возникновения: {debt_basis}
   Дата возникновения: {debt_date}
   Сумма задолженности: {debt_amount} рублей

2. Основание для списания:
{writeoff_reason}

3. Документы, подтверждающие невозможность взыскания:
{supporting_documents}

РЕШЕНИЕ КОМИССИИ:
Списать задолженность в сумме {debt_amount} ({debt_amount_words}) рублей
на {accounting_treatment}.

Председатель комиссии: _____________________ / {chairman_name} /
Члены комиссии: _____________________ / {member1_name} /
                _____________________ / {member2_name} /

УТВЕРЖДАЮ
Руководитель: _____________________ / {director_name} /
«___» __________ 20__ г.
"""


INTERNAL_LOAN_AGREEMENT_TEMPLATE = """
         ДОГОВОР БЕСПРОЦЕНТНОГО ЗАЙМА УЧРЕДИТЕЛЮ/ОТ УЧРЕДИТЕЛЯ № {contract_number}

г. {city}                                           «{day}» {month} {year} г.

{lender_name}, именуемое в дальнейшем «Займодавец», в лице {lender_representative},
действующего на основании {lender_basis}, с одной стороны, и

{borrower_name}, именуемый в дальнейшем «Заёмщик», паспорт {borrower_passport},
с другой стороны,

заключили настоящий Договор:

1. ПРЕДМЕТ ДОГОВОРА
1.1. Займодавец передаёт Заёмщику денежные средства в сумме
{loan_amount} ({loan_amount_words}) рублей.
1.2. Заём является {interest_type}.
1.3. Цель займа: {loan_purpose}.

2. ПОРЯДОК ПРЕДОСТАВЛЕНИЯ И ВОЗВРАТА
2.1. Заём предоставляется путём: {disbursement_method}.
2.2. Срок возврата: до «{return_day}» {return_month} {return_year} г.
2.3. Возврат осуществляется: {return_method}.

3. ОТВЕТСТВЕННОСТЬ
3.1. За просрочку возврата Заёмщик уплачивает пеню {penalty_rate}% в день.

4. РЕКВИЗИТЫ И ПОДПИСИ СТОРОН
ЗАЙМОДАВЕЦ:                              ЗАЁМЩИК:
{lender_name}                             {borrower_name}
{lender_details}                          {borrower_details}
___________________                       ___________________
"""


DIVIDEND_RESOLUTION_TEMPLATE = """
               РЕШЕНИЕ № {resolution_number}
      единственного участника / общего собрания участников
                    {company_name}

г. {city}                                           «{day}» {month} {year} г.

{participant_info}

ПОВЕСТКА ДНЯ:
1. О распределении чистой прибыли общества.
2. О выплате дивидендов.

РЕШИЛИ:

1. Распределить чистую прибыль {company_name} за {period} в размере
{profit_amount} ({profit_amount_words}) рублей следующим образом:

{distribution_details}

2. Выплатить дивиденды участникам общества:
{dividend_payments}

3. Срок выплаты дивидендов: до «{payment_deadline}».
4. Способ выплаты: {payment_method}.
5. Налоговый агент удерживает НДФЛ по ставке {tax_rate}%.

Единственный участник /
Председатель собрания: _____________________ / {chairman_name} /

Секретарь: _____________________ / {secretary_name} /
"""


ACCOUNTING_POLICY_TEMPLATE = """
                                  УТВЕРЖДАЮ
                                  Директор {company_name}
                                  _____________________ / {director_name} /
                                  «___» __________ 20__ г.

                         УЧЁТНАЯ ПОЛИТИКА
                    {company_name} на {year} год

                    для целей бухгалтерского учёта

1. ОБЩИЕ ПОЛОЖЕНИЯ
1.1. Настоящая учётная политика разработана в соответствии с:
- Федеральным законом от 06.12.2011 № 402-ФЗ «О бухгалтерском учёте»;
- Положениями по бухгалтерскому учёту (ПБУ);
- Планом счетов бухгалтерского учёта.

1.2. Ответственный за ведение бухгалтерского учёта: {accountant_responsible}.

2. ОРГАНИЗАЦИОННО-ТЕХНИЧЕСКИЙ РАЗДЕЛ
2.1. Бухгалтерский учёт ведётся: {accounting_method}.
2.2. Форма бухгалтерского учёта: {accounting_form}.
2.3. Рабочий план счетов: Приложение № 1.
2.4. Первичные документы: {primary_docs_policy}.
2.5. Документооборот: Приложение № 2.

3. МЕТОДИЧЕСКИЙ РАЗДЕЛ
3.1. Учёт основных средств:
- Лимит стоимости ОС: {os_limit} рублей.
- Метод амортизации: {depreciation_method}.
- Срок полезного использования: согласно Классификации ОС.

3.2. Учёт материально-производственных запасов:
- Оценка при списании: {inventory_valuation}.
- Учёт транспортно-заготовительных расходов: {tzr_method}.

3.3. Учёт доходов и расходов:
- Признание выручки: {revenue_recognition}.
- Классификация расходов: {expense_classification}.

3.4. Резервы:
- Резерв по сомнительным долгам: {doubtful_debt_reserve}.
- Резерв на отпуска: {vacation_reserve}.

3.5. Учёт расчётов с бюджетом:
- Налог на прибыль: ПБУ 18/02 {pbu_18_applied}.

4. ИНВЕНТАРИЗАЦИЯ
4.1. Сроки проведения: {inventory_schedule}.
4.2. Порядок проведения: Приложение № 3.

5. ХРАНЕНИЕ ДОКУМЕНТОВ
5.1. Срок хранения первичных документов: {storage_period}.

Главный бухгалтер: _____________________ / {accountant_name} /
"""


INVENTORY_ACT_TEMPLATE = """
                                                    Унифицированная форма № ИНВ-3
                                                    Утв. пост. Госкомстата России
                                                    от 18.08.98 № 88

{organization_name}
Структурное подразделение: {department}

                    ИНВЕНТАРИЗАЦИОННАЯ ОПИСЬ
                  товарно-материальных ценностей № {inventory_number}

Дата начала инвентаризации: {start_date}
Дата окончания инвентаризации: {end_date}

Основание: приказ № {order_number} от {order_date}

Комиссия в составе:
Председатель: {chairman_name}, {chairman_position}
Члены: {members_list}

произвела инвентаризацию ТМЦ, находящихся на ответственном хранении
у {responsible_person}, {responsible_position}.

Расписка: К началу инвентаризации все документы сданы в бухгалтерию,
все поступившие ценности оприходованы, выбывшие списаны.

┌────┬───────────────┬───────┬───────┬──────────────────┬─────────────────────┐
│ №  │ Наименование  │Ед.изм.│ Цена  │  Фактическое     │    По данным        │
│п/п │               │       │       │  наличие         │    бух. учёта       │
│    │               │       │       │  кол-во │ сумма  │   кол-во  │  сумма  │
├────┼───────────────┼───────┼───────┼─────────┼────────┼───────────┼─────────┤
{items_table}
├────┴───────────────┴───────┴───────┼─────────┼────────┼───────────┼─────────┤
│ Итого:                             │{fact_qty}│{fact_sum}│{book_qty}│{book_sum}│
└────────────────────────────────────┴─────────┴────────┴───────────┴─────────┘

Председатель комиссии: _____________________ / {chairman_name} /
Члены комиссии: _____________________ / {member1_name} /
                _____________________ / {member2_name} /

Материально ответственное лицо: _____________________ / {responsible_person} /
"""


FIXED_ASSET_ACT_TEMPLATE = """
                                                    Унифицированная форма № ОС-1
                                                    Утв. пост. Госкомстата России
                                                    от 21.01.2003 № 7

{organization_name}

               АКТ О ПРИЁМЕ-ПЕРЕДАЧЕ ОБЪЕКТА ОСНОВНЫХ СРЕДСТВ
                           (кроме зданий, сооружений)

                           № {act_number} от {act_date}

Организация-получатель: {recipient_name}
Организация-сдатчик: {transferor_name}
Основание для составления акта: {basis_document}
Дата принятия к учёту: {accounting_date}
Счёт, субсчёт, код аналитического учёта: {account_code}
Местонахождение объекта: {location}
Инвентарный номер: {inventory_number}

                      1. СВЕДЕНИЯ О СОСТОЯНИИ ОБЪЕКТА

┌───────────────────────────────────────────────────────────────────────────────┐
│ Наименование объекта: {asset_name}                                            │
│ Заводской номер: {factory_number}                                             │
│ Дата выпуска (год постройки): {manufacture_date}                              │
│ Организация-изготовитель: {manufacturer}                                      │
└───────────────────────────────────────────────────────────────────────────────┘

                      2. СВЕДЕНИЯ ОБ ОБЪЕКТЕ НА ДАТУ ПЕРЕДАЧИ

┌────────────────────────────────────┬──────────────────────────────────────────┐
│ Первоначальная стоимость           │ {initial_cost}                           │
│ Срок полезного использования       │ {useful_life}                            │
│ Сумма начисленной амортизации      │ {accumulated_depreciation}               │
│ Остаточная стоимость               │ {residual_value}                         │
└────────────────────────────────────┴──────────────────────────────────────────┘

                      3. ЗАКЛЮЧЕНИЕ КОМИССИИ

{commission_conclusion}

Председатель комиссии: {chairman_position} _____________________ / {chairman_name} /
Члены комиссии: {member1_position} _____________________ / {member1_name} /
               {member2_position} _____________________ / {member2_name} /

Объект основных средств принят: _____________________ / {receiver_name} /
Отметка бухгалтерии: _____________________ / {accountant_name} /

М.П.
"""


DEPRECIATION_SCHEDULE_TEMPLATE = """
                         ВЕДОМОСТЬ НАЧИСЛЕНИЯ АМОРТИЗАЦИИ
                               за {period} {year} г.

{organization_name}

┌────┬─────────────────┬───────────┬────────────┬───────────┬─────────┬─────────┬─────────┐
│ №  │ Наименование ОС │Инвентарный│Первонач.   │Срок полезн│Норма    │Сумма    │Накоплен.│
│п/п │                 │номер      │стоимость   │использ.   │аморт.   │аморт.   │аморт.   │
│    │                 │           │            │(мес.)     │в мес.   │за период│         │
├────┼─────────────────┼───────────┼────────────┼───────────┼─────────┼─────────┼─────────┤
{depreciation_table}
├────┴─────────────────┴───────────┼────────────┼───────────┼─────────┼─────────┼─────────┤
│ Итого:                           │{total_cost}│     X     │    X    │{period_dep}│{total_dep}│
└──────────────────────────────────┴────────────┴───────────┴─────────┴─────────┴─────────┘

Метод начисления амортизации: {depreciation_method}

Бухгалтер: _____________________ / {accountant_name} /
Дата: «___» __________ 20__ г.
"""


# =============================================================================
# Financial Template Service
# =============================================================================

class FinancialTemplateService:
    """Service for generating financial and accounting documents."""

    TEMPLATES = {
        FinancialDocType.INVOICE: INVOICE_TEMPLATE,
        FinancialDocType.ACT_COMPLETED_WORKS: ACT_COMPLETED_WORKS_TEMPLATE,
        FinancialDocType.TORG_12: TORG_12_TEMPLATE,
        FinancialDocType.INVOICE_FACTURA: INVOICE_FACTURA_TEMPLATE,
        FinancialDocType.UPD: UPD_TEMPLATE,
        FinancialDocType.CASH_RECEIPT: CASH_RECEIPT_ORDER_TEMPLATE,
        FinancialDocType.CASH_DISBURSEMENT: CASH_DISBURSEMENT_ORDER_TEMPLATE,
        FinancialDocType.ADVANCE_REPORT: ADVANCE_REPORT_TEMPLATE,
        FinancialDocType.POA_GOODS: POA_GOODS_TEMPLATE,
        FinancialDocType.RECONCILIATION_ACT: RECONCILIATION_ACT_TEMPLATE,
        FinancialDocType.DEBT_WRITEOFF: DEBT_WRITEOFF_ACT_TEMPLATE,
        FinancialDocType.INTERNAL_LOAN: INTERNAL_LOAN_AGREEMENT_TEMPLATE,
        FinancialDocType.DIVIDEND_RESOLUTION: DIVIDEND_RESOLUTION_TEMPLATE,
        FinancialDocType.ACCOUNTING_POLICY: ACCOUNTING_POLICY_TEMPLATE,
        FinancialDocType.INVENTORY_ACT: INVENTORY_ACT_TEMPLATE,
        FinancialDocType.FIXED_ASSET_ACT: FIXED_ASSET_ACT_TEMPLATE,
        FinancialDocType.DEPRECIATION_SCHEDULE: DEPRECIATION_SCHEDULE_TEMPLATE,
    }

    TEMPLATE_NAMES = {
        FinancialDocType.INVOICE: "Счёт на оплату",
        FinancialDocType.ACT_COMPLETED_WORKS: "Акт выполненных работ",
        FinancialDocType.TORG_12: "Товарная накладная ТОРГ-12",
        FinancialDocType.INVOICE_FACTURA: "Счёт-фактура",
        FinancialDocType.UPD: "Универсальный передаточный документ",
        FinancialDocType.CASH_RECEIPT: "Приходный кассовый ордер (КО-1)",
        FinancialDocType.CASH_DISBURSEMENT: "Расходный кассовый ордер (КО-2)",
        FinancialDocType.ADVANCE_REPORT: "Авансовый отчёт (АО-1)",
        FinancialDocType.POA_GOODS: "Доверенность на получение ТМЦ (М-2)",
        FinancialDocType.RECONCILIATION_ACT: "Акт сверки взаимных расчётов",
        FinancialDocType.DEBT_WRITEOFF: "Акт списания задолженности",
        FinancialDocType.INTERNAL_LOAN: "Договор займа учредителю/от учредителя",
        FinancialDocType.DIVIDEND_RESOLUTION: "Решение о выплате дивидендов",
        FinancialDocType.ACCOUNTING_POLICY: "Учётная политика",
        FinancialDocType.INVENTORY_ACT: "Инвентаризационная опись (ИНВ-3)",
        FinancialDocType.FIXED_ASSET_ACT: "Акт приёма-передачи ОС (ОС-1)",
        FinancialDocType.DEPRECIATION_SCHEDULE: "Ведомость начисления амортизации",
    }

    @classmethod
    def get_template(cls, doc_type: FinancialDocType) -> str:
        return cls.TEMPLATES.get(doc_type, "")

    @classmethod
    def get_template_name(cls, doc_type: FinancialDocType) -> str:
        return cls.TEMPLATE_NAMES.get(doc_type, "")

    @classmethod
    def list_templates(cls) -> List[Dict[str, str]]:
        return [
            {"type": dt.value, "name": cls.TEMPLATE_NAMES[dt]}
            for dt in FinancialDocType
        ]

    @classmethod
    def generate_document(cls, doc_type: FinancialDocType, data: Dict[str, Any]) -> str:
        template = cls.get_template(doc_type)
        if not template:
            raise ValueError(f"Unknown document type: {doc_type}")

        if "day" not in data:
            today = date.today()
            data["day"] = str(today.day).zfill(2)
            data["month"] = cls._get_russian_month(today.month)
            data["year"] = str(today.year)

        try:
            return template.format(**data)
        except KeyError as e:
            raise ValueError(f"Missing required field: {e}")

    @staticmethod
    def _get_russian_month(month: int) -> str:
        months = {
            1: "января", 2: "февраля", 3: "марта", 4: "апреля",
            5: "мая", 6: "июня", 7: "июля", 8: "августа",
            9: "сентября", 10: "октября", 11: "ноября", 12: "декабря"
        }
        return months.get(month, "")
