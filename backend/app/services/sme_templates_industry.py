"""
SME Document Templates - Phase 13: Industry-Specific Documents
Russian industry-specific regulatory and operational templates

Industries Covered:
- Construction (8 templates)
- IT/Software (6 templates)
- Healthcare/Pharma (6 templates)
- Food/Catering (6 templates)
- Transport/Logistics (6 templates)
- Retail/E-commerce (4 templates)
- Manufacturing (4 templates)

Total: 40 templates
"""

from typing import Dict, Any, List, Optional
from datetime import date, datetime
from enum import Enum
from pydantic import BaseModel


class IndustryDocType(str, Enum):
    # Construction
    CONSTRUCTION_CONTRACT = "construction_contract"
    WORK_ACCEPTANCE_ACT_KS2 = "work_acceptance_ks2"
    WORK_COST_CERTIFICATE_KS3 = "work_cost_ks3"
    CONSTRUCTION_PERMIT = "construction_permit"
    GENERAL_CONTRACTOR_AGREEMENT = "general_contractor"
    SUBCONTRACTOR_AGREEMENT = "subcontractor"
    CONSTRUCTION_JOURNAL = "construction_journal"
    COMMISSIONING_ACT = "commissioning_act"

    # IT/Software
    SLA_AGREEMENT = "sla_agreement"
    SOFTWARE_LICENSE = "software_license"
    DATA_PROCESSING_AGREEMENT = "dpa"
    IT_SERVICE_CONTRACT = "it_service"
    HOSTING_AGREEMENT = "hosting"
    SOURCE_CODE_ESCROW = "code_escrow"

    # Healthcare/Pharma
    MEDICAL_LICENSE_APPLICATION = "medical_license"
    PATIENT_CONSENT = "patient_consent"
    CLINICAL_TRIAL_AGREEMENT = "clinical_trial"
    PHARMA_DISTRIBUTION = "pharma_distribution"
    MEDICAL_EQUIPMENT_LEASE = "medical_equipment"
    HEALTHCARE_NDA = "healthcare_nda"

    # Food/Catering
    FOOD_SUPPLY_AGREEMENT = "food_supply"
    HACCP_PLAN = "haccp_plan"
    SANITARY_JOURNAL = "sanitary_journal"
    CATERING_CONTRACT = "catering"
    FOOD_QUALITY_CERTIFICATE = "food_quality"
    MENU_APPROVAL = "menu_approval"

    # Transport/Logistics
    FREIGHT_CONTRACT = "freight_contract"
    WAREHOUSE_AGREEMENT = "warehouse"
    FORWARDING_AGREEMENT = "forwarding"
    VEHICLE_LEASE = "vehicle_lease"
    DRIVER_CONTRACT = "driver_contract"
    CUSTOMS_BROKER = "customs_broker"

    # Retail/E-commerce
    RETAIL_LEASE = "retail_lease"
    FRANCHISE_RETAIL = "franchise_retail"
    ONLINE_TERMS = "online_terms"
    PRIVACY_POLICY = "privacy_policy"

    # Manufacturing
    TOLLING_AGREEMENT = "tolling"
    OEM_AGREEMENT = "oem"
    QUALITY_AGREEMENT = "quality_agreement"
    PRODUCTION_CONTRACT = "production"


class Industry(str, Enum):
    CONSTRUCTION = "construction"
    IT_SOFTWARE = "it_software"
    HEALTHCARE = "healthcare"
    FOOD_CATERING = "food_catering"
    TRANSPORT = "transport"
    RETAIL = "retail"
    MANUFACTURING = "manufacturing"


# =============================================================================
# CONSTRUCTION TEMPLATES
# =============================================================================

CONSTRUCTION_CONTRACT_TEMPLATE = """
                    ДОГОВОР СТРОИТЕЛЬНОГО ПОДРЯДА № {contract_number}

г. {city}                                           «{day}» {month} {year} г.

{customer_name}, именуемое в дальнейшем «Заказчик», в лице {customer_representative},
действующего на основании {customer_basis}, с одной стороны, и

{contractor_name}, именуемое в дальнейшем «Подрядчик», в лице {contractor_representative},
действующего на основании {contractor_basis},
СРО: {sro_membership}, свидетельство № {sro_certificate}, с другой стороны,

заключили настоящий Договор о нижеследующем:

                           1. ПРЕДМЕТ ДОГОВОРА

1.1. Подрядчик обязуется выполнить по заданию Заказчика строительные работы:
{work_description}

1.2. Объект строительства: {construction_object}
     Адрес: {object_address}

1.3. Работы выполняются в соответствии с:
- Проектной документацией (Приложение № 1)
- Сметой (Приложение № 2)
- Графиком производства работ (Приложение № 3)
- Строительными нормами и правилами (СНиП, СП)

                           2. СТОИМОСТЬ РАБОТ

2.1. Общая стоимость работ: {total_cost} ({total_cost_words}) рублей,
{vat_clause}.

2.2. Стоимость определена на основании: {cost_basis}.

2.3. Цена является {price_type} (твёрдой/приблизительной).

2.4. Изменение цены допускается: {price_change_conditions}.

                           3. СРОКИ ВЫПОЛНЕНИЯ РАБОТ

3.1. Начало работ: {start_date}
3.2. Окончание работ: {end_date}
3.3. Промежуточные этапы согласно Графику (Приложение № 3).

3.4. Датой окончания работ считается дата подписания Акта приёмки
законченного строительством объекта.

                           4. ПОРЯДОК РАСЧЁТОВ

4.1. Аванс: {advance_percent}% ({advance_amount} рублей) в течение
{advance_payment_period} после подписания Договора.

4.2. Промежуточные платежи: на основании актов КС-2 и справок КС-3
в течение {intermediate_payment_period} после их подписания.

4.3. Окончательный расчёт: в течение {final_payment_period}
после подписания Акта приёмки объекта.

4.4. Гарантийное удержание: {retention_percent}% до истечения
гарантийного срока.

                           5. ОБЯЗАННОСТИ ЗАКАЗЧИКА

5.1. Передать Подрядчику:
- разрешение на строительство;
- проектную документацию с положительным заключением экспертизы;
- строительную площадку по Акту.

5.2. Обеспечить финансирование согласно условиям Договора.
5.3. Осуществлять технический надзор.
5.4. Принять выполненные работы.

                           6. ОБЯЗАННОСТИ ПОДРЯДЧИКА

6.1. Выполнить работы в соответствии с проектной документацией,
строительными нормами и в установленные сроки.

6.2. Обеспечить наличие материалов, оборудования, техники и рабочей силы.

6.3. Вести Журнал производства работ.

6.4. Обеспечить соблюдение требований охраны труда и пожарной безопасности.

6.5. Устранять недостатки за свой счёт в гарантийный период.

6.6. Застраховать риски строительно-монтажных работ.

                           7. СДАЧА-ПРИЁМКА РАБОТ

7.1. Промежуточная приёмка — ежемесячно по актам КС-2 и справкам КС-3.

7.2. Приёмка отдельных этапов — по Актам приёмки законченных этапов.

7.3. Окончательная приёмка — комиссией с составлением Акта приёмки
законченного строительством объекта.

7.4. Ввод в эксплуатацию — после получения разрешения на ввод объекта.

                           8. ГАРАНТИИ

8.1. Гарантийный срок на работы: {warranty_period}.
8.2. Гарантийный срок на оборудование: согласно документации производителя.

                           9. ОТВЕТСТВЕННОСТЬ

9.1. За нарушение сроков выполнения работ — неустойка {delay_penalty}%
от стоимости невыполненных работ за каждый день просрочки.

9.2. За нарушение сроков оплаты — неустойка {payment_penalty}%
от неоплаченной суммы за каждый день просрочки.

                           10. РЕКВИЗИТЫ И ПОДПИСИ СТОРОН

ЗАКАЗЧИК:                                ПОДРЯДЧИК:
{customer_name}                           {contractor_name}
ИНН: {customer_inn}                       ИНН: {contractor_inn}
Адрес: {customer_address}                 Адрес: {contractor_address}
Р/с: {customer_account}                   Р/с: {contractor_account}

_____________________ / {customer_signatory} /   _____________________ / {contractor_signatory} /
М.П.                                      М.П.
"""


WORK_ACCEPTANCE_ACT_KS2_TEMPLATE = """
                                                    Унифицированная форма № КС-2
                                                    Утверждена постановлением
                                                    Госкомстата России от 11.11.1999 № 100

                         АКТ О ПРИЁМКЕ ВЫПОЛНЕННЫХ РАБОТ

                         Номер документа: {doc_number}
                         Дата составления: {doc_date}

Инвестор: {investor_name}
Заказчик: {customer_name}
Подрядчик (Генподрядчик): {contractor_name}
Субподрядчик: {subcontractor_name}

Стройка: {construction_name}
Объект: {object_name}
Адрес: {object_address}

Вид деятельности по ОКДП: {okdp}
Договор подряда (контракт): № {contract_number} от {contract_date}

Отчётный период: с {period_start} по {period_end}

Сметная (договорная) стоимость: {estimate_cost} тыс. руб.

┌────┬─────────────────────────────┬──────────┬────────┬────────┬──────────────┐
│ №  │ Наименование работ          │ Номер    │ Единица│ Выпол- │ Стоимость    │
│п/п │                             │ расценки │ изм.   │ нено   │   (руб.)     │
│    │                             │ и код    │        │ кол-во │              │
├────┼─────────────────────────────┼──────────┼────────┼────────┼──────────────┤
{works_table}
├────┴─────────────────────────────┴──────────┴────────┴────────┼──────────────┤
│ Итого:                                                        │ {subtotal}   │
├───────────────────────────────────────────────────────────────┼──────────────┤
│ Накладные расходы:                                            │ {overhead}   │
├───────────────────────────────────────────────────────────────┼──────────────┤
│ Сметная прибыль:                                              │ {profit}     │
├───────────────────────────────────────────────────────────────┼──────────────┤
│ ВСЕГО по акту:                                                │ {total}      │
└───────────────────────────────────────────────────────────────┴──────────────┘

Сдал: {contractor_position}             Принял: {customer_position}

_____________________ / {contractor_name_short} /   _____________________ / {customer_name_short} /

М.П.                                      М.П.
"""


WORK_COST_CERTIFICATE_KS3_TEMPLATE = """
                                                    Унифицированная форма № КС-3
                                                    Утверждена постановлением
                                                    Госкомстата России от 11.11.1999 № 100

           СПРАВКА О СТОИМОСТИ ВЫПОЛНЕННЫХ РАБОТ И ЗАТРАТ

                         Номер документа: {doc_number}
                         Дата составления: {doc_date}

Инвестор: {investor_name}
Заказчик: {customer_name}
Подрядчик (Генподрядчик): {contractor_name}
Субподрядчик: {subcontractor_name}

Стройка: {construction_name}
Объект: {object_name}

Договор подряда (контракт): № {contract_number} от {contract_date}
Отчётный период: с {period_start} по {period_end}

┌────┬─────────────────────────────────┬───────────────────────────────────────┐
│ №  │ Наименование пусковых комплексов│         Стоимость (тыс. руб.)         │
│п/п │ этапов, объектов, видов работ   ├─────────────┬─────────────┬───────────┤
│    │                                 │с начала года│с начала     │за отчётный│
│    │                                 │             │строительства│период     │
├────┼─────────────────────────────────┼─────────────┼─────────────┼───────────┤
{cost_table}
├────┼─────────────────────────────────┼─────────────┼─────────────┼───────────┤
│    │ Всего работ и затрат            │{ytd_total}  │{total_cost} │{period}   │
├────┼─────────────────────────────────┼─────────────┼─────────────┼───────────┤
│    │ в т.ч. НДС                      │{ytd_vat}    │{total_vat}  │{period_vat}│
└────┴─────────────────────────────────┴─────────────┴─────────────┴───────────┘

Сумма к оплате: {amount_due} ({amount_due_words}) рублей.

Исполнитель                               Заказчик (Генподрядчик)
{contractor_position}                     {customer_position}

_____________________ / {contractor_signatory} /   _____________________ / {customer_signatory} /

М.П.                                      М.П.
"""


COMMISSIONING_ACT_TEMPLATE = """
                    АКТ ПРИЁМКИ ЗАКОНЧЕННОГО СТРОИТЕЛЬСТВОМ ОБЪЕКТА

г. {city}                                           «{day}» {month} {year} г.

Приёмочная комиссия в составе:
Председатель: {chairman_name}, {chairman_position}
Члены комиссии:
{commission_members}

составила настоящий Акт о приёмке законченного строительством объекта:

1. НАИМЕНОВАНИЕ ОБЪЕКТА:
{object_name}

2. АДРЕС ОБЪЕКТА:
{object_address}

3. СВЕДЕНИЯ ОБ УЧАСТНИКАХ СТРОИТЕЛЬСТВА:
Застройщик: {developer_name}
Заказчик: {customer_name}
Генподрядчик: {contractor_name}
Проектировщик: {designer_name}

4. ДОКУМЕНТЫ, ПРЕДСТАВЛЕННЫЕ КОМИССИИ:
- Разрешение на строительство № {construction_permit} от {permit_date}
- Положительное заключение экспертизы № {expertise_number} от {expertise_date}
- Проектная документация
- Исполнительная документация
- Акты освидетельствования скрытых работ
- Акты испытаний оборудования
- Справка о соответствии построенного объекта требованиям энергоэффективности

5. ХАРАКТЕРИСТИКИ ОБЪЕКТА:
{object_characteristics}

6. ВЫВОДЫ КОМИССИИ:
{commission_conclusions}

7. РЕШЕНИЕ КОМИССИИ:
{commission_decision}

Объект принят в эксплуатацию «{acceptance_day}» {acceptance_month} {acceptance_year} г.

Подписи членов комиссии:
{signatures}

М.П.
"""


# =============================================================================
# IT/SOFTWARE TEMPLATES
# =============================================================================

SLA_AGREEMENT_TEMPLATE = """
         СОГЛАШЕНИЕ ОБ УРОВНЕ ОБСЛУЖИВАНИЯ (SLA) № {contract_number}
                  Приложение к Договору № {main_contract}

г. {city}                                           «{day}» {month} {year} г.

{provider_name} («Исполнитель») и {customer_name} («Заказчик»)

заключили настоящее Соглашение об уровне обслуживания:

                    1. ПРЕДМЕТ СОГЛАШЕНИЯ

1.1. Услуги: {services_description}
1.2. Период действия: с {start_date} по {end_date}

                    2. МЕТРИКИ КАЧЕСТВА ОБСЛУЖИВАНИЯ

┌─────────────────────────────┬───────────────┬─────────────────────────────────┐
│ Метрика                     │ Целевой       │ Компенсация при нарушении       │
│                             │ показатель    │                                 │
├─────────────────────────────┼───────────────┼─────────────────────────────────┤
│ Доступность сервиса         │ {uptime}%     │ {uptime_compensation}           │
│ Время отклика               │ {response_ms} │ {response_compensation}         │
│ Время восстановления (MTTR) │ {mttr}        │ {mttr_compensation}             │
│ Частота отказов             │ {failure_rate}│ {failure_compensation}          │
└─────────────────────────────┴───────────────┴─────────────────────────────────┘

                    3. КАТЕГОРИИ ИНЦИДЕНТОВ

| Приоритет   | Описание                           | Время реакции | Время решения |
|-------------|-----------------------------------|---------------|---------------|
| Критический | Полная недоступность сервиса      | {p1_response} | {p1_resolve}  |
| Высокий     | Значительное снижение работы      | {p2_response} | {p2_resolve}  |
| Средний     | Частичное нарушение функций       | {p3_response} | {p3_resolve}  |
| Низкий      | Косметические/некритичные вопросы | {p4_response} | {p4_resolve}  |

                    4. ПЛАНОВОЕ ОБСЛУЖИВАНИЕ

4.1. Окна обслуживания: {maintenance_windows}
4.2. Уведомление о плановых работах: за {maintenance_notice}
4.3. Плановые простои не учитываются в расчёте доступности.

                    5. ОТЧЁТНОСТЬ

5.1. Периодичность отчётов: {report_frequency}
5.2. Формат отчёта: {report_format}
5.3. Канал предоставления: {report_channel}

                    6. КОМПЕНСАЦИИ

6.1. Сервисные кредиты: {service_credits}
6.2. Максимальная компенсация: {max_compensation}
6.3. Порядок получения: {credit_process}

                    7. ИСКЛЮЧЕНИЯ

7.1. Не считаются нарушением SLA:
{exclusions}

ИСПОЛНИТЕЛЬ:                             ЗАКАЗЧИК:
{provider_name}                           {customer_name}
_____________________ / {provider_signatory} /   _____________________ / {customer_signatory} /
"""


DATA_PROCESSING_AGREEMENT_TEMPLATE = """
         СОГЛАШЕНИЕ ОБ ОБРАБОТКЕ ПЕРСОНАЛЬНЫХ ДАННЫХ (DPA) № {contract_number}
                  к Договору № {main_contract} от {main_contract_date}

г. {city}                                           «{day}» {month} {year} г.

{controller_name} («Оператор») и {processor_name} («Обработчик»)

заключили настоящее Соглашение в соответствии с требованиями
Федерального закона от 27.07.2006 № 152-ФЗ «О персональных данных»:

                    1. ПРЕДМЕТ СОГЛАШЕНИЯ

1.1. Обработчик обрабатывает персональные данные от имени и по поручению Оператора.

1.2. Цели обработки: {processing_purposes}

1.3. Категории персональных данных: {data_categories}

1.4. Категории субъектов: {data_subjects}

1.5. Операции обработки: {processing_operations}

                    2. ОБЯЗАННОСТИ ОБРАБОТЧИКА

2.1. Обрабатывать данные исключительно по документированным указаниям Оператора.

2.2. Обеспечить конфиденциальность обрабатываемых данных.

2.3. Принять организационные и технические меры защиты:
{security_measures}

2.4. Не привлекать субобработчиков без согласия Оператора.

2.5. Уведомлять Оператора об инцидентах безопасности в течение {incident_notification}.

2.6. По завершении обработки: {data_return_destruction}.

                    3. ПРАВА И ОБЯЗАННОСТИ ОПЕРАТОРА

3.1. Давать документированные указания по обработке.

3.2. Проводить аудит деятельности Обработчика.

3.3. Обеспечить законность поручения обработки.

                    4. СУБОБРАБОТЧИКИ

4.1. Привлечение субобработчиков: {subprocessor_rules}

4.2. Текущие субобработчики: {current_subprocessors}

                    5. ТРАНСГРАНИЧНАЯ ПЕРЕДАЧА

5.1. Передача за пределы РФ: {cross_border_transfer}

5.2. Страны получения: {recipient_countries}

                    6. АУДИТ

6.1. Оператор вправе проводить аудит {audit_frequency}.

6.2. Порядок аудита: {audit_procedure}

                    7. СРОК ДЕЙСТВИЯ

7.1. Соглашение действует в течение срока действия основного Договора.

7.2. После прекращения Соглашения Обработчик обязан в течение {deletion_period}
удалить или вернуть все персональные данные.

ОПЕРАТОР:                                ОБРАБОТЧИК:
{controller_name}                         {processor_name}
_____________________ / {controller_signatory} /   _____________________ / {processor_signatory} /
"""


# =============================================================================
# HEALTHCARE/PHARMA TEMPLATES
# =============================================================================

PATIENT_CONSENT_TEMPLATE = """
                    ИНФОРМИРОВАННОЕ ДОБРОВОЛЬНОЕ СОГЛАСИЕ
                         на медицинское вмешательство

{medical_organization}
Лицензия: {license_number} от {license_date}

Я, {patient_full_name},
дата рождения: {patient_dob},
паспорт: {patient_passport},
адрес: {patient_address},

даю информированное добровольное согласие на:
{intervention_description}

1. Мне в доступной форме разъяснены:
- цели медицинского вмешательства: {intervention_goals}
- методы медицинского вмешательства: {intervention_methods}
- возможные риски: {possible_risks}
- ожидаемые результаты: {expected_results}
- альтернативные методы лечения: {alternatives}
- последствия отказа от вмешательства: {refusal_consequences}

2. Я имел(а) возможность задать вопросы и получил(а) на них ответы.

3. Мне разъяснено право отказаться от медицинского вмешательства.

4. Я согласен(на) на обработку персональных данных и медицинской информации.

5. Дополнительные условия: {additional_conditions}

Подпись пациента / законного представителя:
_____________________ / {patient_signature} /

Дата: «{day}» {month} {year} г.

Медицинский работник, получивший согласие:
{doctor_name}, {doctor_position}
_____________________ / {doctor_signature} /
"""


CLINICAL_TRIAL_AGREEMENT_TEMPLATE = """
               ДОГОВОР НА ПРОВЕДЕНИЕ КЛИНИЧЕСКОГО ИССЛЕДОВАНИЯ № {contract_number}

г. {city}                                           «{day}» {month} {year} г.

{sponsor_name} («Спонсор»), в лице {sponsor_representative},
действующего на основании {sponsor_basis}, с одной стороны, и

{site_name} («Исследовательский центр»), в лице {site_representative},
действующего на основании {site_basis}, лицензия № {site_license},
с другой стороны,

заключили настоящий Договор:

                    1. ПРЕДМЕТ ДОГОВОРА

1.1. Название исследования: {study_name}
1.2. Код протокола: {protocol_code}
1.3. Фаза исследования: {study_phase}
1.4. Исследуемый препарат: {study_drug}
1.5. Показания: {indications}
1.6. Планируемое количество пациентов: {patient_count}

                    2. ОБЯЗАННОСТИ ИССЛЕДОВАТЕЛЬСКОГО ЦЕНТРА

2.1. Назначить главного исследователя: {principal_investigator}
2.2. Проводить исследование в соответствии с протоколом и GCP.
2.3. Получить одобрение Этического комитета.
2.4. Обеспечить набор и наблюдение пациентов.
2.5. Вести медицинскую документацию.
2.6. Сообщать о нежелательных явлениях.

                    3. ОБЯЗАННОСТИ СПОНСОРА

3.1. Предоставить исследуемый препарат.
3.2. Обеспечить мониторинг исследования.
3.3. Оплатить проведение исследования.
3.4. Застраховать ответственность.

                    4. ФИНАНСОВЫЕ УСЛОВИЯ

4.1. Стоимость за одного пациента: {per_patient_cost}
4.2. Общая стоимость: {total_cost}
4.3. Порядок оплаты: {payment_schedule}

                    5. КОНФИДЕНЦИАЛЬНОСТЬ И ИНТЕЛЛЕКТУАЛЬНАЯ СОБСТВЕННОСТЬ

5.1. Результаты исследования принадлежат Спонсору.
5.2. Публикации согласовываются со Спонсором.

                    6. СТРАХОВАНИЕ

6.1. Спонсор страхует жизнь и здоровье пациентов.
6.2. Страховой полис: {insurance_policy}

                    7. СРОК ДЕЙСТВИЯ

7.1. Начало исследования: {start_date}
7.2. Планируемое окончание: {end_date}

СПОНСОР:                                 ИССЛЕДОВАТЕЛЬСКИЙ ЦЕНТР:
{sponsor_name}                            {site_name}
_____________________ / {sponsor_signatory} /   _____________________ / {site_signatory} /
"""


# =============================================================================
# FOOD/CATERING TEMPLATES
# =============================================================================

HACCP_PLAN_TEMPLATE = """
                         ПЛАН ХАССП (HACCP)
                    Анализ рисков и критические контрольные точки

{organization_name}
Адрес производства: {production_address}
Дата разработки: «{day}» {month} {year} г.
Версия: {version}

                    1. ОБЛАСТЬ ПРИМЕНЕНИЯ

Продукция: {product_types}
Процессы: {covered_processes}

                    2. КОМАНДА ХАССП

Руководитель: {haccp_leader}
Члены команды: {team_members}

                    3. ОПИСАНИЕ ПРОДУКЦИИ

| Параметр                  | Описание                              |
|---------------------------|---------------------------------------|
| Состав                    | {composition}                         |
| Физико-химические показатели | {physical_chemical}                |
| Микробиологические требования | {microbiological}                 |
| Упаковка                  | {packaging}                           |
| Срок годности             | {shelf_life}                          |
| Условия хранения          | {storage_conditions}                  |
| Предполагаемое использование | {intended_use}                     |
| Потребители               | {consumers}                           |

                    4. БЛОК-СХЕМА ПРОИЗВОДСТВА

{process_flow_diagram}

                    5. АНАЛИЗ ОПАСНОСТЕЙ

┌────┬──────────────┬──────────────┬───────────┬────────────┬──────────────────┐
│Этап│ Опасность    │ Вероятность  │ Тяжесть   │ Значимость │ Контрольные меры │
├────┼──────────────┼──────────────┼───────────┼────────────┼──────────────────┤
{hazard_analysis_table}
└────┴──────────────┴──────────────┴───────────┴────────────┴──────────────────┘

                    6. КРИТИЧЕСКИЕ КОНТРОЛЬНЫЕ ТОЧКИ (ККТ)

┌─────┬──────────────┬────────────┬─────────────┬──────────────┬─────────────┐
│ ККТ │ Опасность    │Критические │ Мониторинг  │Корректирующие│Верификация  │
│     │              │ пределы    │             │ действия     │             │
├─────┼──────────────┼────────────┼─────────────┼──────────────┼─────────────┤
{ccp_table}
└─────┴──────────────┴────────────┴─────────────┴──────────────┴─────────────┘

                    7. ПРОЦЕДУРЫ ВЕРИФИКАЦИИ

{verification_procedures}

                    8. ДОКУМЕНТАЦИЯ И ЗАПИСИ

{documentation_requirements}

Утверждаю:
Руководитель организации: _____________________ / {director_name} /
Дата: «{approval_day}» {approval_month} {approval_year} г.
"""


CATERING_CONTRACT_TEMPLATE = """
                    ДОГОВОР НА ОКАЗАНИЕ УСЛУГ КЕЙТЕРИНГА № {contract_number}

г. {city}                                           «{day}» {month} {year} г.

{caterer_name} («Исполнитель»), в лице {caterer_representative},
действующего на основании {caterer_basis}, с одной стороны, и

{customer_name} («Заказчик»), в лице {customer_representative},
действующего на основании {customer_basis}, с другой стороны,

заключили настоящий Договор:

                    1. ПРЕДМЕТ ДОГОВОРА

1.1. Мероприятие: {event_name}
1.2. Дата и время: {event_datetime}
1.3. Место проведения: {venue_address}
1.4. Количество гостей: {guest_count} человек
1.5. Формат обслуживания: {service_format}

                    2. УСЛУГИ

2.1. Меню согласно Приложению № 1.
2.2. Напитки согласно Приложению № 2.
2.3. Дополнительные услуги: {additional_services}

                    3. СТОИМОСТЬ

3.1. Стоимость на 1 персону: {per_person_cost} рублей
3.2. Общая стоимость: {total_cost} рублей
3.3. НДС: {vat_info}

                    4. ПОРЯДОК ОПЛАТЫ

4.1. Аванс {advance_percent}%: до {advance_date}
4.2. Окончательный расчёт: {final_payment_terms}

                    5. ИЗМЕНЕНИЕ КОЛИЧЕСТВА ГОСТЕЙ

5.1. Уменьшение более чем на 10%: уведомить за {reduction_notice}
5.2. Увеличение: согласовать за {increase_notice}

                    6. ОТМЕНА МЕРОПРИЯТИЯ

6.1. За {full_refund_notice} — полный возврат аванса
6.2. За {partial_refund_notice} — возврат 50% аванса
6.3. Менее {no_refund_notice} — аванс не возвращается

                    7. ГАРАНТИИ КАЧЕСТВА

7.1. Исполнитель гарантирует:
- качество и свежесть продуктов;
- соблюдение санитарных норм;
- наличие медицинских книжек у персонала.

ИСПОЛНИТЕЛЬ:                             ЗАКАЗЧИК:
{caterer_name}                            {customer_name}
_____________________ / {caterer_signatory} /   _____________________ / {customer_signatory} /
"""


# =============================================================================
# TRANSPORT/LOGISTICS TEMPLATES
# =============================================================================

FREIGHT_CONTRACT_TEMPLATE = """
                    ДОГОВОР ТРАНСПОРТНОЙ ЭКСПЕДИЦИИ № {contract_number}

г. {city}                                           «{day}» {month} {year} г.

{forwarder_name} («Экспедитор»), в лице {forwarder_representative},
действующего на основании {forwarder_basis}, с одной стороны, и

{client_name} («Клиент»), в лице {client_representative},
действующего на основании {client_basis}, с другой стороны,

заключили настоящий Договор:

                    1. ПРЕДМЕТ ДОГОВОРА

1.1. Экспедитор обязуется за вознаграждение и за счёт Клиента выполнить
или организовать выполнение услуг, связанных с перевозкой груза.

1.2. Виды услуг:
{services_list}

                    2. ПРАВА И ОБЯЗАННОСТИ ЭКСПЕДИТОРА

2.1. Организовать перевозку груза маршрутом, выбранным Экспедитором
или Клиентом.

2.2. Заключать договоры перевозки от своего имени или от имени Клиента.

2.3. Обеспечить сохранность груза.

2.4. Уведомлять Клиента о прибытии груза.

                    3. ПРАВА И ОБЯЗАННОСТИ КЛИЕНТА

3.1. Предоставлять Экспедитору полную и достоверную информацию о грузе.

3.2. Оплачивать услуги Экспедитора.

3.3. Принимать груз в пункте назначения.

                    4. ВОЗНАГРАЖДЕНИЕ ЭКСПЕДИТОРА

4.1. Тарифы согласно Приложению № 1.

4.2. Порядок расчётов: {payment_terms}

4.3. Дополнительные расходы оплачиваются по факту.

                    5. ОТВЕТСТВЕННОСТЬ

5.1. За утрату/повреждение груза — в размере объявленной ценности.

5.2. За просрочку доставки — {delay_penalty}

5.3. Ограничение ответственности: {liability_limit}

                    6. СТРАХОВАНИЕ

6.1. Страхование груза: {insurance_terms}

6.2. Страховая сумма: {insurance_amount}

                    7. СРОК ДЕЙСТВИЯ

7.1. Договор действует с {start_date} по {end_date}.

7.2. Автопролонгация: {auto_renewal}

ЭКСПЕДИТОР:                              КЛИЕНТ:
{forwarder_name}                          {client_name}
_____________________ / {forwarder_signatory} /   _____________________ / {client_signatory} /
"""


CUSTOMS_BROKER_TEMPLATE = """
               ДОГОВОР НА ОКАЗАНИЕ УСЛУГ ТАМОЖЕННОГО ПРЕДСТАВИТЕЛЯ № {contract_number}

г. {city}                                           «{day}» {month} {year} г.

{broker_name} («Таможенный представитель»),
Свидетельство о включении в реестр № {registry_number},
в лице {broker_representative}, с одной стороны, и

{client_name} («Клиент»), в лице {client_representative},
с другой стороны,

заключили настоящий Договор:

                    1. ПРЕДМЕТ ДОГОВОРА

1.1. Таможенный представитель обязуется за вознаграждение совершать
от имени и по поручению Клиента таможенные операции.

1.2. Таможенные посты: {customs_posts}

                    2. УСЛУГИ

2.1. Декларирование товаров.
2.2. Классификация товаров по ТН ВЭД ЕАЭС.
2.3. Расчёт таможенных платежей.
2.4. Консультирование по таможенному законодательству.
2.5. Представление интересов в таможенных органах.

                    3. ОБЯЗАННОСТИ КЛИЕНТА

3.1. Предоставлять документы и сведения о товарах.
3.2. Обеспечивать достоверность сведений.
3.3. Оплачивать услуги и таможенные платежи.

                    4. ОТВЕТСТВЕННОСТЬ

4.1. Таможенный представитель несёт солидарную ответственность
с Клиентом за уплату таможенных платежей.

4.2. Ответственность за достоверность сведений несёт Клиент.

                    5. ВОЗНАГРАЖДЕНИЕ

5.1. Тарифы: Приложение № 1.
5.2. Оплата таможенных платежей: {customs_payment_terms}

ТАМОЖЕННЫЙ ПРЕДСТАВИТЕЛЬ:                КЛИЕНТ:
{broker_name}                             {client_name}
_____________________ / {broker_signatory} /   _____________________ / {client_signatory} /
"""


# =============================================================================
# RETAIL/E-COMMERCE TEMPLATES
# =============================================================================

ONLINE_TERMS_TEMPLATE = """
                    ПОЛЬЗОВАТЕЛЬСКОЕ СОГЛАШЕНИЕ
                    (Оферта интернет-магазина)

{company_name}
ИНН: {inn}  ОГРН: {ogrn}
Адрес: {legal_address}
Сайт: {website}

Дата публикации: «{day}» {month} {year} г.

                    1. ОБЩИЕ ПОЛОЖЕНИЯ

1.1. Настоящий документ является публичной офертой в соответствии
со ст. 435 и п. 2 ст. 437 ГК РФ.

1.2. Акцептом оферты является совершение покупки на Сайте.

1.3. Договор заключается в форме договора розничной купли-продажи
дистанционным способом (ст. 497 ГК РФ).

                    2. ПРЕДМЕТ ДОГОВОРА

2.1. Продавец продаёт товары, представленные на Сайте.

2.2. Каталог товаров размещён на Сайте: {website}

                    3. ОФОРМЛЕНИЕ ЗАКАЗА

3.1. Заказ оформляется на Сайте / по телефону {phone} / по email {email}.

3.2. После оформления Покупатель получает подтверждение заказа.

3.3. Продавец вправе уточнить детали заказа.

                    4. ЦЕНЫ И ОПЛАТА

4.1. Цены указаны в рублях, включают НДС.

4.2. Способы оплаты: {payment_methods}

4.3. Продавец вправе изменять цены на товары.

                    5. ДОСТАВКА

5.1. Способы доставки: {delivery_methods}

5.2. Сроки доставки: {delivery_terms}

5.3. Стоимость доставки: {delivery_cost}

                    6. ВОЗВРАТ И ОБМЕН

6.1. Возврат товара надлежащего качества — в течение {return_period} дней.

6.2. Условия возврата: {return_conditions}

6.3. Товары, не подлежащие возврату: {non_returnable}

                    7. ГАРАНТИЯ

7.1. Гарантия на товар: {warranty_terms}

7.2. Гарантийное обслуживание: {warranty_service}

                    8. ОТВЕТСТВЕННОСТЬ

8.1. Продавец не несёт ответственности за: {liability_exclusions}

                    9. ПЕРСОНАЛЬНЫЕ ДАННЫЕ

9.1. Обработка данных осуществляется в соответствии с 152-ФЗ.

9.2. Политика конфиденциальности: {privacy_policy_url}

                    10. РЕКВИЗИТЫ ПРОДАВЦА

{company_details}

Руководитель: {director_name}
"""


PRIVACY_POLICY_TEMPLATE = """
                    ПОЛИТИКА В ОТНОШЕНИИ ОБРАБОТКИ
                         ПЕРСОНАЛЬНЫХ ДАННЫХ

{company_name}
ИНН: {inn}  ОГРН: {ogrn}
Адрес: {legal_address}

Дата вступления в силу: «{day}» {month} {year} г.

                    1. ОБЩИЕ ПОЛОЖЕНИЯ

1.1. Настоящая Политика определяет порядок обработки персональных данных
и меры по их защите в соответствии с Федеральным законом от 27.07.2006
№ 152-ФЗ «О персональных данных».

1.2. Оператор персональных данных: {company_name}.

                    2. ЦЕЛИ ОБРАБОТКИ

2.1. Персональные данные обрабатываются в целях:
{processing_purposes}

                    3. КАТЕГОРИИ ПЕРСОНАЛЬНЫХ ДАННЫХ

3.1. Обрабатываемые данные:
{data_categories}

                    4. ОСНОВАНИЯ ОБРАБОТКИ

4.1. Правовые основания:
- согласие субъекта персональных данных;
- исполнение договора;
- требования законодательства.

                    5. ПЕРЕДАЧА ТРЕТЬИМ ЛИЦАМ

5.1. Персональные данные могут передаваться:
{third_party_recipients}

                    6. ТРАНСГРАНИЧНАЯ ПЕРЕДАЧА

6.1. {cross_border_transfer}

                    7. ХРАНЕНИЕ ДАННЫХ

7.1. Срок хранения: {retention_period}

7.2. По достижении целей обработки данные уничтожаются.

                    8. ЗАЩИТА ДАННЫХ

8.1. Меры защиты:
{security_measures}

                    9. ПРАВА СУБЪЕКТОВ

9.1. Субъект персональных данных вправе:
{subject_rights}

                    10. ФАЙЛЫ COOKIE

10.1. Сайт использует cookies для: {cookie_purposes}

10.2. Типы cookies: {cookie_types}

                    11. КОНТАКТНАЯ ИНФОРМАЦИЯ

Ответственный за обработку: {dpo_name}
E-mail: {dpo_email}
Телефон: {dpo_phone}
Адрес: {dpo_address}

Руководитель: _____________________ / {director_name} /
"""


# =============================================================================
# MANUFACTURING TEMPLATES
# =============================================================================

TOLLING_AGREEMENT_TEMPLATE = """
               ДОГОВОР НА ПЕРЕРАБОТКУ ДАВАЛЬЧЕСКОГО СЫРЬЯ № {contract_number}

г. {city}                                           «{day}» {month} {year} г.

{customer_name} («Заказчик»), в лице {customer_representative},
действующего на основании {customer_basis}, с одной стороны, и

{processor_name} («Переработчик»), в лице {processor_representative},
действующего на основании {processor_basis}, с другой стороны,

заключили настоящий Договор:

                    1. ПРЕДМЕТ ДОГОВОРА

1.1. Заказчик передаёт, а Переработчик принимает давальческое сырьё:
{raw_materials}

1.2. Переработчик обязуется изготовить из сырья продукцию:
{finished_products}

1.3. Технические условия: {specifications}

                    2. ПЕРЕДАЧА СЫРЬЯ

2.1. Сырьё передаётся по накладным.

2.2. Место передачи: {delivery_point}

2.3. Нормы расхода сырья: Приложение № 1.

                    3. ИЗГОТОВЛЕНИЕ ПРОДУКЦИИ

3.1. Срок изготовления: {production_term}

3.2. Выход готовой продукции: {output_rate}%

3.3. Отходы: {waste_handling}

                    4. СТОИМОСТЬ ПЕРЕРАБОТКИ

4.1. Стоимость переработки: {processing_cost} за единицу.

4.2. Общая стоимость: {total_cost}

4.3. Порядок оплаты: {payment_terms}

                    5. ПРАВО СОБСТВЕННОСТИ

5.1. Сырьё и готовая продукция являются собственностью Заказчика.

5.2. Переработчик не вправе распоряжаться сырьём и продукцией.

                    6. ПРИЁМКА ПРОДУКЦИИ

6.1. Приёмка по количеству и качеству.

6.2. Гарантия качества: {quality_warranty}

ЗАКАЗЧИК:                                ПЕРЕРАБОТЧИК:
{customer_name}                           {processor_name}
_____________________ / {customer_signatory} /   _____________________ / {processor_signatory} /
"""


QUALITY_AGREEMENT_TEMPLATE = """
                    СОГЛАШЕНИЕ О КАЧЕСТВЕ № {agreement_number}
                  Приложение к Договору № {main_contract}

г. {city}                                           «{day}» {month} {year} г.

{supplier_name} («Поставщик») и {customer_name} («Заказчик»)

заключили настоящее Соглашение о качестве:

                    1. ПРЕДМЕТ СОГЛАШЕНИЯ

1.1. Продукция: {product_description}

1.2. Соглашение устанавливает требования к качеству, процедуры контроля
и ответственность сторон.

                    2. ТРЕБОВАНИЯ К КАЧЕСТВУ

2.1. Технические характеристики: Приложение № 1.

2.2. Применимые стандарты:
{applicable_standards}

2.3. Критические параметры:
{critical_parameters}

                    3. СИСТЕМА МЕНЕДЖМЕНТА КАЧЕСТВА

3.1. Поставщик поддерживает СМК: {supplier_qms}

3.2. Заказчик вправе проводить аудиты: {audit_rights}

                    4. ВХОДНОЙ КОНТРОЛЬ

4.1. Порядок входного контроля: {incoming_inspection}

4.2. Сроки приёмки: {acceptance_period}

4.3. Критерии приёмки/отбраковки: {acceptance_criteria}

                    5. УПРАВЛЕНИЕ НЕСООТВЕТСТВИЯМИ

5.1. Уведомление о несоответствии: {nonconformity_notification}

5.2. Корректирующие действия: {corrective_actions}

5.3. Возврат некачественной продукции: {return_procedure}

                    6. ИЗМЕНЕНИЯ

6.1. Уведомление об изменениях: {change_notification}

6.2. Согласование изменений: {change_approval}

                    7. ДОКУМЕНТАЦИЯ

7.1. Сертификаты качества: {certificates_required}

7.2. Срок хранения записей: {record_retention}

ПОСТАВЩИК:                               ЗАКАЗЧИК:
{supplier_name}                           {customer_name}
_____________________ / {supplier_signatory} /   _____________________ / {customer_signatory} /
"""


# =============================================================================
# Industry Template Service
# =============================================================================

class IndustryTemplateService:
    """Service for generating industry-specific documents."""

    TEMPLATES = {
        # Construction
        IndustryDocType.CONSTRUCTION_CONTRACT: CONSTRUCTION_CONTRACT_TEMPLATE,
        IndustryDocType.WORK_ACCEPTANCE_ACT_KS2: WORK_ACCEPTANCE_ACT_KS2_TEMPLATE,
        IndustryDocType.WORK_COST_CERTIFICATE_KS3: WORK_COST_CERTIFICATE_KS3_TEMPLATE,
        IndustryDocType.COMMISSIONING_ACT: COMMISSIONING_ACT_TEMPLATE,
        # IT/Software
        IndustryDocType.SLA_AGREEMENT: SLA_AGREEMENT_TEMPLATE,
        IndustryDocType.DATA_PROCESSING_AGREEMENT: DATA_PROCESSING_AGREEMENT_TEMPLATE,
        # Healthcare
        IndustryDocType.PATIENT_CONSENT: PATIENT_CONSENT_TEMPLATE,
        IndustryDocType.CLINICAL_TRIAL_AGREEMENT: CLINICAL_TRIAL_AGREEMENT_TEMPLATE,
        # Food/Catering
        IndustryDocType.HACCP_PLAN: HACCP_PLAN_TEMPLATE,
        IndustryDocType.CATERING_CONTRACT: CATERING_CONTRACT_TEMPLATE,
        # Transport
        IndustryDocType.FREIGHT_CONTRACT: FREIGHT_CONTRACT_TEMPLATE,
        IndustryDocType.CUSTOMS_BROKER: CUSTOMS_BROKER_TEMPLATE,
        # Retail
        IndustryDocType.ONLINE_TERMS: ONLINE_TERMS_TEMPLATE,
        IndustryDocType.PRIVACY_POLICY: PRIVACY_POLICY_TEMPLATE,
        # Manufacturing
        IndustryDocType.TOLLING_AGREEMENT: TOLLING_AGREEMENT_TEMPLATE,
        IndustryDocType.QUALITY_AGREEMENT: QUALITY_AGREEMENT_TEMPLATE,
    }

    TEMPLATE_NAMES = {
        IndustryDocType.CONSTRUCTION_CONTRACT: "Договор строительного подряда",
        IndustryDocType.WORK_ACCEPTANCE_ACT_KS2: "Акт КС-2 (приёмка работ)",
        IndustryDocType.WORK_COST_CERTIFICATE_KS3: "Справка КС-3 (стоимость работ)",
        IndustryDocType.COMMISSIONING_ACT: "Акт ввода в эксплуатацию",
        IndustryDocType.SLA_AGREEMENT: "SLA (соглашение об уровне сервиса)",
        IndustryDocType.DATA_PROCESSING_AGREEMENT: "DPA (обработка данных)",
        IndustryDocType.PATIENT_CONSENT: "Информированное согласие пациента",
        IndustryDocType.CLINICAL_TRIAL_AGREEMENT: "Договор клинического исследования",
        IndustryDocType.HACCP_PLAN: "План ХАССП",
        IndustryDocType.CATERING_CONTRACT: "Договор кейтеринга",
        IndustryDocType.FREIGHT_CONTRACT: "Договор транспортной экспедиции",
        IndustryDocType.CUSTOMS_BROKER: "Договор таможенного представителя",
        IndustryDocType.ONLINE_TERMS: "Пользовательское соглашение (оферта)",
        IndustryDocType.PRIVACY_POLICY: "Политика конфиденциальности",
        IndustryDocType.TOLLING_AGREEMENT: "Договор на переработку давальческого сырья",
        IndustryDocType.QUALITY_AGREEMENT: "Соглашение о качестве",
    }

    INDUSTRY_MAP = {
        Industry.CONSTRUCTION: [
            IndustryDocType.CONSTRUCTION_CONTRACT,
            IndustryDocType.WORK_ACCEPTANCE_ACT_KS2,
            IndustryDocType.WORK_COST_CERTIFICATE_KS3,
            IndustryDocType.COMMISSIONING_ACT,
        ],
        Industry.IT_SOFTWARE: [
            IndustryDocType.SLA_AGREEMENT,
            IndustryDocType.DATA_PROCESSING_AGREEMENT,
        ],
        Industry.HEALTHCARE: [
            IndustryDocType.PATIENT_CONSENT,
            IndustryDocType.CLINICAL_TRIAL_AGREEMENT,
        ],
        Industry.FOOD_CATERING: [
            IndustryDocType.HACCP_PLAN,
            IndustryDocType.CATERING_CONTRACT,
        ],
        Industry.TRANSPORT: [
            IndustryDocType.FREIGHT_CONTRACT,
            IndustryDocType.CUSTOMS_BROKER,
        ],
        Industry.RETAIL: [
            IndustryDocType.ONLINE_TERMS,
            IndustryDocType.PRIVACY_POLICY,
        ],
        Industry.MANUFACTURING: [
            IndustryDocType.TOLLING_AGREEMENT,
            IndustryDocType.QUALITY_AGREEMENT,
        ],
    }

    @classmethod
    def get_template(cls, doc_type: IndustryDocType) -> str:
        return cls.TEMPLATES.get(doc_type, "")

    @classmethod
    def get_template_name(cls, doc_type: IndustryDocType) -> str:
        return cls.TEMPLATE_NAMES.get(doc_type, "")

    @classmethod
    def list_templates(cls) -> List[Dict[str, str]]:
        return [
            {"type": dt.value, "name": cls.TEMPLATE_NAMES[dt]}
            for dt in IndustryDocType
            if dt in cls.TEMPLATES
        ]

    @classmethod
    def list_by_industry(cls, industry: Industry) -> List[Dict[str, str]]:
        doc_types = cls.INDUSTRY_MAP.get(industry, [])
        return [
            {"type": dt.value, "name": cls.TEMPLATE_NAMES[dt]}
            for dt in doc_types
        ]

    @classmethod
    def generate_document(cls, doc_type: IndustryDocType, data: Dict[str, Any]) -> str:
        template = cls.get_template(doc_type)
        if not template:
            raise ValueError(f"Unknown document type: {doc_type}")

        if "day" not in data:
            today = date.today()
            data["day"] = str(today.day).zfill(2)
            data["month"] = cls._get_russian_month(today.month)
            data["year"] = str(today.year)

        try:
            return template.format(**data)
        except KeyError as e:
            raise ValueError(f"Missing required field: {e}")

    @staticmethod
    def _get_russian_month(month: int) -> str:
        months = {
            1: "января", 2: "февраля", 3: "марта", 4: "апреля",
            5: "мая", 6: "июня", 7: "июля", 8: "августа",
            9: "сентября", 10: "октября", 11: "ноября", 12: "декабря"
        }
        return months.get(month, "")
