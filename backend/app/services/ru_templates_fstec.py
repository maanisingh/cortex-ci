"""
ФСТЭК России - Complete Document Package
Covers all major FSTEC orders for information security:
- Приказ № 17 (Government IS protection)
- Приказ № 21 (Personal data IS protection)
- Приказ № 31 (APCS protection)
- Приказ № 239 (KII objects protection)

Each order requires specific security measures based on protection class/level.
"""

from typing import Any

# FSTEC Security Measures Catalog
SECURITY_MEASURES = {
    "IAF": {
        "name": "Идентификация и аутентификация",
        "name_en": "Identification and Authentication",
        "measures": [
            {"code": "ИАФ.1", "name": "Идентификация и аутентификация пользователей", "levels": ["УЗ-4", "УЗ-3", "УЗ-2", "УЗ-1"]},
            {"code": "ИАФ.2", "name": "Идентификация и аутентификация устройств", "levels": ["УЗ-3", "УЗ-2", "УЗ-1"]},
            {"code": "ИАФ.3", "name": "Управление идентификаторами", "levels": ["УЗ-4", "УЗ-3", "УЗ-2", "УЗ-1"]},
            {"code": "ИАФ.4", "name": "Управление средствами аутентификации", "levels": ["УЗ-4", "УЗ-3", "УЗ-2", "УЗ-1"]},
            {"code": "ИАФ.5", "name": "Защита обратной связи при вводе аутентификационной информации", "levels": ["УЗ-4", "УЗ-3", "УЗ-2", "УЗ-1"]},
            {"code": "ИАФ.6", "name": "Идентификация и аутентификация пользователей, не являющихся работниками оператора", "levels": ["УЗ-3", "УЗ-2", "УЗ-1"]},
        ],
    },
    "UPD": {
        "name": "Управление доступом",
        "name_en": "Access Control",
        "measures": [
            {"code": "УПД.1", "name": "Управление учётными записями пользователей", "levels": ["УЗ-4", "УЗ-3", "УЗ-2", "УЗ-1"]},
            {"code": "УПД.2", "name": "Реализация необходимых методов управления доступом", "levels": ["УЗ-4", "УЗ-3", "УЗ-2", "УЗ-1"]},
            {"code": "УПД.3", "name": "Управление информационными потоками", "levels": ["УЗ-3", "УЗ-2", "УЗ-1"]},
            {"code": "УПД.4", "name": "Разделение полномочий пользователей", "levels": ["УЗ-4", "УЗ-3", "УЗ-2", "УЗ-1"]},
            {"code": "УПД.5", "name": "Назначение минимально необходимых прав и привилегий", "levels": ["УЗ-4", "УЗ-3", "УЗ-2", "УЗ-1"]},
            {"code": "УПД.6", "name": "Ограничение неуспешных попыток входа", "levels": ["УЗ-4", "УЗ-3", "УЗ-2", "УЗ-1"]},
            {"code": "УПД.10", "name": "Блокирование сеанса доступа", "levels": ["УЗ-4", "УЗ-3", "УЗ-2", "УЗ-1"]},
            {"code": "УПД.11", "name": "Разрешённые действия без идентификации", "levels": ["УЗ-4", "УЗ-3", "УЗ-2", "УЗ-1"]},
            {"code": "УПД.13", "name": "Реализация защищённого удалённого доступа", "levels": ["УЗ-4", "УЗ-3", "УЗ-2", "УЗ-1"]},
            {"code": "УПД.14", "name": "Реализация защищённого удалённого доступа через внешние сети", "levels": ["УЗ-3", "УЗ-2", "УЗ-1"]},
            {"code": "УПД.15", "name": "Регламентация и контроль использования беспроводного доступа", "levels": ["УЗ-3", "УЗ-2", "УЗ-1"]},
            {"code": "УПД.16", "name": "Регламентация и контроль использования мобильных устройств", "levels": ["УЗ-3", "УЗ-2", "УЗ-1"]},
            {"code": "УПД.17", "name": "Обеспечение доверенной загрузки", "levels": ["УЗ-2", "УЗ-1"]},
        ],
    },
    "OPS": {
        "name": "Защита машинных носителей",
        "name_en": "Storage Media Protection",
        "measures": [
            {"code": "ЗНИ.1", "name": "Учёт машинных носителей информации", "levels": ["УЗ-4", "УЗ-3", "УЗ-2", "УЗ-1"]},
            {"code": "ЗНИ.2", "name": "Управление доступом к машинным носителям", "levels": ["УЗ-4", "УЗ-3", "УЗ-2", "УЗ-1"]},
            {"code": "ЗНИ.3", "name": "Контроль перемещения машинных носителей", "levels": ["УЗ-3", "УЗ-2", "УЗ-1"]},
            {"code": "ЗНИ.4", "name": "Исключение возможности несанкционированного ознакомления", "levels": ["УЗ-3", "УЗ-2", "УЗ-1"]},
            {"code": "ЗНИ.5", "name": "Контроль использования интерфейсов ввода-вывода", "levels": ["УЗ-3", "УЗ-2", "УЗ-1"]},
            {"code": "ЗНИ.6", "name": "Контроль ввода-вывода на отчуждаемые носители", "levels": ["УЗ-3", "УЗ-2", "УЗ-1"]},
            {"code": "ЗНИ.7", "name": "Контроль подключения машинных носителей", "levels": ["УЗ-3", "УЗ-2", "УЗ-1"]},
            {"code": "ЗНИ.8", "name": "Уничтожение (стирание) информации на носителях", "levels": ["УЗ-4", "УЗ-3", "УЗ-2", "УЗ-1"]},
        ],
    },
    "RSB": {
        "name": "Регистрация событий безопасности",
        "name_en": "Security Event Logging",
        "measures": [
            {"code": "РСБ.1", "name": "Определение событий безопасности, подлежащих регистрации", "levels": ["УЗ-4", "УЗ-3", "УЗ-2", "УЗ-1"]},
            {"code": "РСБ.2", "name": "Определение состава и содержания информации о событиях", "levels": ["УЗ-4", "УЗ-3", "УЗ-2", "УЗ-1"]},
            {"code": "РСБ.3", "name": "Сбор, запись и хранение информации о событиях", "levels": ["УЗ-4", "УЗ-3", "УЗ-2", "УЗ-1"]},
            {"code": "РСБ.4", "name": "Реагирование на сбои при регистрации событий", "levels": ["УЗ-3", "УЗ-2", "УЗ-1"]},
            {"code": "РСБ.5", "name": "Мониторинг (просмотр, анализ) результатов регистрации", "levels": ["УЗ-4", "УЗ-3", "УЗ-2", "УЗ-1"]},
            {"code": "РСБ.6", "name": "Генерирование временных меток", "levels": ["УЗ-4", "УЗ-3", "УЗ-2", "УЗ-1"]},
            {"code": "РСБ.7", "name": "Защита информации о событиях безопасности", "levels": ["УЗ-4", "УЗ-3", "УЗ-2", "УЗ-1"]},
        ],
    },
    "AVZ": {
        "name": "Антивирусная защита",
        "name_en": "Antivirus Protection",
        "measures": [
            {"code": "АВЗ.1", "name": "Реализация антивирусной защиты", "levels": ["УЗ-4", "УЗ-3", "УЗ-2", "УЗ-1"]},
            {"code": "АВЗ.2", "name": "Обновление базы данных признаков вредоносных программ", "levels": ["УЗ-4", "УЗ-3", "УЗ-2", "УЗ-1"]},
        ],
    },
    "SOV": {
        "name": "Обнаружение вторжений",
        "name_en": "Intrusion Detection",
        "measures": [
            {"code": "СОВ.1", "name": "Обнаружение вторжений", "levels": ["УЗ-3", "УЗ-2", "УЗ-1"]},
            {"code": "СОВ.2", "name": "Обновление базы решающих правил", "levels": ["УЗ-3", "УЗ-2", "УЗ-1"]},
        ],
    },
    "AKN": {
        "name": "Контроль (анализ) защищённости",
        "name_en": "Security Analysis",
        "measures": [
            {"code": "АНЗ.1", "name": "Выявление, анализ уязвимостей и оперативное устранение", "levels": ["УЗ-4", "УЗ-3", "УЗ-2", "УЗ-1"]},
            {"code": "АНЗ.2", "name": "Контроль установки обновлений ПО", "levels": ["УЗ-4", "УЗ-3", "УЗ-2", "УЗ-1"]},
            {"code": "АНЗ.3", "name": "Контроль работоспособности средств защиты", "levels": ["УЗ-4", "УЗ-3", "УЗ-2", "УЗ-1"]},
            {"code": "АНЗ.4", "name": "Контроль состава технических средств, ПО и СЗИ", "levels": ["УЗ-4", "УЗ-3", "УЗ-2", "УЗ-1"]},
            {"code": "АНЗ.5", "name": "Контроль правил генерации и смены паролей", "levels": ["УЗ-4", "УЗ-3", "УЗ-2", "УЗ-1"]},
        ],
    },
    "OTsL": {
        "name": "Обеспечение целостности",
        "name_en": "Integrity Protection",
        "measures": [
            {"code": "ОЦЛ.1", "name": "Контроль целостности ПО и СЗИ", "levels": ["УЗ-4", "УЗ-3", "УЗ-2", "УЗ-1"]},
            {"code": "ОЦЛ.2", "name": "Контроль целостности информации", "levels": ["УЗ-3", "УЗ-2", "УЗ-1"]},
            {"code": "ОЦЛ.3", "name": "Обеспечение возможности восстановления ПО и СЗИ", "levels": ["УЗ-4", "УЗ-3", "УЗ-2", "УЗ-1"]},
            {"code": "ОЦЛ.4", "name": "Обнаружение и реагирование на поступление незапрашиваемых сообщений", "levels": ["УЗ-3", "УЗ-2", "УЗ-1"]},
            {"code": "ОЦЛ.5", "name": "Контроль содержимого информации", "levels": ["УЗ-2", "УЗ-1"]},
        ],
    },
    "ODS": {
        "name": "Обеспечение доступности",
        "name_en": "Availability Protection",
        "measures": [
            {"code": "ОДТ.1", "name": "Использование отказоустойчивых технических средств", "levels": ["УЗ-2", "УЗ-1"]},
            {"code": "ОДТ.2", "name": "Резервирование технических средств, ПО, каналов", "levels": ["УЗ-2", "УЗ-1"]},
            {"code": "ОДТ.3", "name": "Контроль безотказного функционирования", "levels": ["УЗ-2", "УЗ-1"]},
            {"code": "ОДТ.4", "name": "Периодическое резервное копирование информации", "levels": ["УЗ-4", "УЗ-3", "УЗ-2", "УЗ-1"]},
            {"code": "ОДТ.5", "name": "Обеспечение возможности восстановления информации", "levels": ["УЗ-4", "УЗ-3", "УЗ-2", "УЗ-1"]},
        ],
    },
    "ZTS": {
        "name": "Защита среды виртуализации",
        "name_en": "Virtualization Protection",
        "measures": [
            {"code": "ЗСВ.1", "name": "Идентификация и аутентификация субъектов и объектов в виртуальной инфраструктуре", "levels": ["УЗ-4", "УЗ-3", "УЗ-2", "УЗ-1"]},
            {"code": "ЗСВ.2", "name": "Управление доступом субъектов к объектам в виртуальной инфраструктуре", "levels": ["УЗ-4", "УЗ-3", "УЗ-2", "УЗ-1"]},
            {"code": "ЗСВ.3", "name": "Регистрация событий безопасности в виртуальной инфраструктуре", "levels": ["УЗ-4", "УЗ-3", "УЗ-2", "УЗ-1"]},
            {"code": "ЗСВ.9", "name": "Реализация и управление антивирусной защитой в виртуальной инфраструктуре", "levels": ["УЗ-4", "УЗ-3", "УЗ-2", "УЗ-1"]},
            {"code": "ЗСВ.10", "name": "Разбиение виртуальной инфраструктуры на сегменты", "levels": ["УЗ-3", "УЗ-2", "УЗ-1"]},
        ],
    },
    "ZIS": {
        "name": "Защита информационной системы",
        "name_en": "Information System Protection",
        "measures": [
            {"code": "ЗИС.1", "name": "Разделение информационной системы на сегменты", "levels": ["УЗ-3", "УЗ-2", "УЗ-1"]},
            {"code": "ЗИС.2", "name": "Обеспечение защиты информации при взаимодействии с внешними системами", "levels": ["УЗ-4", "УЗ-3", "УЗ-2", "УЗ-1"]},
            {"code": "ЗИС.3", "name": "Обеспечение защиты информации при использовании мобильных устройств", "levels": ["УЗ-3", "УЗ-2", "УЗ-1"]},
            {"code": "ЗИС.4", "name": "Обеспечение защиты информации при использовании беспроводного доступа", "levels": ["УЗ-3", "УЗ-2", "УЗ-1"]},
            {"code": "ЗИС.5", "name": "Запрет несанкционированной удалённой активации устройств", "levels": ["УЗ-3", "УЗ-2", "УЗ-1"]},
            {"code": "ЗИС.17", "name": "Защита периметра информационной системы", "levels": ["УЗ-4", "УЗ-3", "УЗ-2", "УЗ-1"]},
            {"code": "ЗИС.20", "name": "Защита беспроводных соединений", "levels": ["УЗ-4", "УЗ-3", "УЗ-2", "УЗ-1"]},
        ],
    },
}

# FSTEC Document Templates
TEMPLATES_FSTEC: list[dict[str, Any]] = [
    # ============ ПРИКАЗ № 21 (PERSONAL DATA) ============
    {
        "template_code": "FSTEC21_SECURITY_PROJECT",
        "title": "Технический проект системы защиты ИСПДн",
        "title_en": "ISPDN Security System Technical Design",
        "document_type": "technical_design",
        "framework": "fstec21",
        "requirement_ref": "Приказ ФСТЭК № 21 п. 8",
        "form_fields": [
            {"name": "company_name", "label": "Наименование организации", "type": "text", "required": True},
            {"name": "ispdn_name", "label": "Наименование ИСПДн", "type": "text", "required": True},
            {"name": "protection_level", "label": "Уровень защищённости", "type": "select", "required": True,
             "options": ["УЗ-1", "УЗ-2", "УЗ-3", "УЗ-4"]},
            {"name": "developer_name", "label": "Разработчик проекта", "type": "text", "required": True},
        ],
        "template_content": """
УТВЕРЖДАЮ
Генеральный директор
{{company_name}}
_________________ / ___________________ /
«____» _____________ 202__ г.

ТЕХНИЧЕСКИЙ ПРОЕКТ
системы защиты персональных данных
информационной системы «{{ispdn_name}}»

Разработчик: {{developer_name}}
Уровень защищённости: {{protection_level}}

1. ОБЩИЕ СВЕДЕНИЯ

1.1. Наименование ИСПДн: {{ispdn_name}}
1.2. Оператор: {{company_name}}
1.3. Уровень защищённости ПДн: {{protection_level}}
1.4. Основание для разработки: Приказ ФСТЭК России от 18.02.2013 № 21

2. НАЗНАЧЕНИЕ И ЦЕЛИ СОЗДАНИЯ СИСТЕМЫ ЗАЩИТЫ

2.1. Назначение — обеспечение безопасности ПДн при их обработке в ИСПДн.

2.2. Цели:
- обеспечение конфиденциальности ПДн;
- обеспечение целостности ПДн;
- обеспечение доступности ПДн.

3. ХАРАКТЕРИСТИКА ОБЪЕКТА ЗАЩИТЫ

3.1. Описание ИСПДн:
- Назначение: _________________________
- Состав: _________________________
- Архитектура: _________________________

3.2. Категории ПДн:
[ ] Общедоступные
[ ] Иные
[ ] Специальные
[ ] Биометрические

3.3. Категории субъектов ПДн:
- _________________________
- _________________________

3.4. Объём ПДн:
[ ] Менее 100 000 субъектов
[ ] Более 100 000 субъектов

4. МОДЕЛЬ УГРОЗ (КРАТКОЕ ОПИСАНИЕ)

4.1. Актуальные типы угроз:
[ ] 1 тип — угрозы НДВ в системном ПО
[ ] 2 тип — угрозы НДВ в прикладном ПО
[ ] 3 тип — угрозы, не связанные с НДВ

4.2. Основные источники угроз:
- _________________________
- _________________________

5. ТРЕБОВАНИЯ К СИСТЕМЕ ЗАЩИТЫ

5.1. В соответствии с Приказом ФСТЭК № 21 для {{protection_level}} реализуются меры:

5.1.1. Идентификация и аутентификация (ИАФ)
5.1.2. Управление доступом (УПД)
5.1.3. Защита машинных носителей (ЗНИ)
5.1.4. Регистрация событий безопасности (РСБ)
5.1.5. Антивирусная защита (АВЗ)
5.1.6. Контроль защищённости (АНЗ)
5.1.7. Обеспечение целостности (ОЦЛ)
5.1.8. Обеспечение доступности (ОДТ)
5.1.9. Защита среды виртуализации (ЗСВ)
5.1.10. Защита информационной системы (ЗИС)

6. ПРОЕКТНЫЕ РЕШЕНИЯ

6.1. Организационные меры:
- Назначение ответственных лиц
- Разработка ОРД
- Обучение персонала

6.2. Технические меры:

№ | Мера | Средство реализации | Примечание
--|------|---------------------|------------
1 | ИАФ.1 | Active Directory / LDAP |
2 | УПД.1 | Штатные средства ОС |
3 | АВЗ.1 | Kaspersky / Dr.Web / ClamAV |
4 | РСБ.1 | Syslog / ELK Stack |
5 | ЗИС.17 | iptables / pfSense |

7. ПОРЯДОК ВВОДА В ЭКСПЛУАТАЦИЮ

7.1. Этапы:
1) Установка и настройка средств защиты
2) Разработка эксплуатационной документации
3) Обучение персонала
4) Проведение аттестационных испытаний (при необходимости)
5) Ввод в эксплуатацию

8. ТРЕБОВАНИЯ К ДОКУМЕНТАЦИИ

8.1. Эксплуатационная документация:
- Руководство администратора
- Руководство пользователя
- Инструкция по реагированию на инциденты

СОГЛАСОВАНО:

Ответственный за защиту ПДн:    _________________ / _________________ /
Администратор безопасности:      _________________ / _________________ /
""",
    },
    {
        "template_code": "FSTEC21_MEASURES_MATRIX",
        "title": "Матрица мер защиты ИСПДн по Приказу ФСТЭК № 21",
        "title_en": "ISPDN Protection Measures Matrix (FSTEC Order 21)",
        "document_type": "matrix",
        "framework": "fstec21",
        "requirement_ref": "Приказ ФСТЭК № 21 Приложение",
        "form_fields": [
            {"name": "company_name", "label": "Наименование организации", "type": "text", "required": True},
            {"name": "ispdn_name", "label": "Наименование ИСПДн", "type": "text", "required": True},
            {"name": "protection_level", "label": "Уровень защищённости", "type": "select", "required": True,
             "options": ["УЗ-1", "УЗ-2", "УЗ-3", "УЗ-4"]},
        ],
        "template_content": """
{{company_name}}

МАТРИЦА МЕР ЗАЩИТЫ ПЕРСОНАЛЬНЫХ ДАННЫХ
для ИСПДн «{{ispdn_name}}»

Уровень защищённости: {{protection_level}}
Дата формирования: «____» _____________ 202__ г.

Условные обозначения:
+ — мера обязательна для данного УЗ
- — мера не обязательна
А — мера адаптирована
К — мера компенсирована

I. ИДЕНТИФИКАЦИЯ И АУТЕНТИФИКАЦИЯ (ИАФ)

Код | Мера | УЗ-4 | УЗ-3 | УЗ-2 | УЗ-1 | Статус | Средство реализации
----|------|------|------|------|------|--------|--------------------
ИАФ.1 | Идентификация и аутентификация пользователей | + | + | + | + | |
ИАФ.2 | Идентификация и аутентификация устройств | - | + | + | + | |
ИАФ.3 | Управление идентификаторами | + | + | + | + | |
ИАФ.4 | Управление средствами аутентификации | + | + | + | + | |
ИАФ.5 | Защита обратной связи при вводе аутентификации | + | + | + | + | |
ИАФ.6 | Идентификация внешних пользователей | - | + | + | + | |

II. УПРАВЛЕНИЕ ДОСТУПОМ (УПД)

Код | Мера | УЗ-4 | УЗ-3 | УЗ-2 | УЗ-1 | Статус | Средство реализации
----|------|------|------|------|------|--------|--------------------
УПД.1 | Управление учётными записями | + | + | + | + | |
УПД.2 | Реализация методов управления доступом | + | + | + | + | |
УПД.3 | Управление информационными потоками | - | + | + | + | |
УПД.4 | Разделение полномочий пользователей | + | + | + | + | |
УПД.5 | Назначение минимальных привилегий | + | + | + | + | |
УПД.6 | Ограничение неуспешных попыток входа | + | + | + | + | |
УПД.10 | Блокирование сеанса доступа | + | + | + | + | |
УПД.11 | Разрешённые действия без идентификации | + | + | + | + | |
УПД.13 | Защищённый удалённый доступ | + | + | + | + | |
УПД.14 | Удалённый доступ через внешние сети | - | + | + | + | |
УПД.15 | Контроль беспроводного доступа | - | + | + | + | |
УПД.16 | Контроль мобильных устройств | - | + | + | + | |
УПД.17 | Обеспечение доверенной загрузки | - | - | + | + | |

III. ЗАЩИТА МАШИННЫХ НОСИТЕЛЕЙ (ЗНИ)

Код | Мера | УЗ-4 | УЗ-3 | УЗ-2 | УЗ-1 | Статус | Средство реализации
----|------|------|------|------|------|--------|--------------------
ЗНИ.1 | Учёт машинных носителей | + | + | + | + | |
ЗНИ.2 | Управление доступом к носителям | + | + | + | + | |
ЗНИ.3 | Контроль перемещения носителей | - | + | + | + | |
ЗНИ.4 | Исключение несанкц. ознакомления | - | + | + | + | |
ЗНИ.5 | Контроль интерфейсов ввода-вывода | - | + | + | + | |
ЗНИ.8 | Уничтожение информации на носителях | + | + | + | + | |

IV. РЕГИСТРАЦИЯ СОБЫТИЙ БЕЗОПАСНОСТИ (РСБ)

Код | Мера | УЗ-4 | УЗ-3 | УЗ-2 | УЗ-1 | Статус | Средство реализации
----|------|------|------|------|------|--------|--------------------
РСБ.1 | Определение событий для регистрации | + | + | + | + | |
РСБ.2 | Определение состава информации | + | + | + | + | |
РСБ.3 | Сбор и хранение информации о событиях | + | + | + | + | |
РСБ.4 | Реагирование на сбои регистрации | - | + | + | + | |
РСБ.5 | Мониторинг результатов регистрации | + | + | + | + | |
РСБ.6 | Генерирование временных меток | + | + | + | + | |
РСБ.7 | Защита информации о событиях | + | + | + | + | |

V. АНТИВИРУСНАЯ ЗАЩИТА (АВЗ)

Код | Мера | УЗ-4 | УЗ-3 | УЗ-2 | УЗ-1 | Статус | Средство реализации
----|------|------|------|------|------|--------|--------------------
АВЗ.1 | Реализация антивирусной защиты | + | + | + | + | |
АВЗ.2 | Обновление баз данных | + | + | + | + | |

VI. ОБНАРУЖЕНИЕ ВТОРЖЕНИЙ (СОВ)

Код | Мера | УЗ-4 | УЗ-3 | УЗ-2 | УЗ-1 | Статус | Средство реализации
----|------|------|------|------|------|--------|--------------------
СОВ.1 | Обнаружение вторжений | - | + | + | + | |
СОВ.2 | Обновление базы решающих правил | - | + | + | + | |

ИТОГО:
- Обязательных мер для {{protection_level}}: ____
- Реализовано: ____
- Адаптировано: ____
- Компенсировано: ____

Ответственный за защиту ПДн: _________________ / _________________ /
Дата: «____» _____________ 202__ г.
""",
    },
    {
        "template_code": "FSTEC21_ACCEPTANCE_ACT",
        "title": "Акт о вводе системы защиты ИСПДн в эксплуатацию",
        "title_en": "ISPDN Protection System Acceptance Act",
        "document_type": "act",
        "framework": "fstec21",
        "requirement_ref": "Приказ ФСТЭК № 21 п. 12",
        "form_fields": [
            {"name": "company_name", "label": "Наименование организации", "type": "text", "required": True},
            {"name": "ispdn_name", "label": "Наименование ИСПДн", "type": "text", "required": True},
            {"name": "protection_level", "label": "Уровень защищённости", "type": "select", "required": True,
             "options": ["УЗ-1", "УЗ-2", "УЗ-3", "УЗ-4"]},
            {"name": "act_date", "label": "Дата акта", "type": "date", "required": True},
            {"name": "commission_chair", "label": "Председатель комиссии", "type": "text", "required": True},
        ],
        "template_content": """
УТВЕРЖДАЮ
Генеральный директор
{{company_name}}
_________________ / ___________________ /
«____» _____________ 202__ г.

АКТ
о вводе системы защиты персональных данных в эксплуатацию

Дата: {{act_date}}

Комиссия в составе:

Председатель: {{commission_chair}}
Члены комиссии:
- _________________________
- _________________________
- _________________________

провела проверку готовности системы защиты персональных данных информационной системы «{{ispdn_name}}» к вводу в эксплуатацию.

1. ОБЪЕКТ ПРОВЕРКИ

1.1. Наименование ИСПДн: {{ispdn_name}}
1.2. Уровень защищённости: {{protection_level}}
1.3. Оператор: {{company_name}}

2. ПРОВЕРЕННЫЕ ДОКУМЕНТЫ

2.1. Технический проект системы защиты — [ ] Имеется / [ ] Отсутствует
2.2. Модель угроз безопасности ПДн — [ ] Имеется / [ ] Отсутствует
2.3. Акт классификации ИСПДн — [ ] Имеется / [ ] Отсутствует
2.4. Приказы о назначении ответственных — [ ] Имеется / [ ] Отсутствует
2.5. Эксплуатационная документация — [ ] Имеется / [ ] Отсутствует

3. РЕЗУЛЬТАТЫ ПРОВЕРКИ РЕАЛИЗАЦИИ МЕР ЗАЩИТЫ

№ | Группа мер | Статус | Замечания
--|-----------|--------|----------
1 | Идентификация и аутентификация (ИАФ) | [ ] Реализовано / [ ] Частично / [ ] Не реализовано |
2 | Управление доступом (УПД) | [ ] Реализовано / [ ] Частично / [ ] Не реализовано |
3 | Защита машинных носителей (ЗНИ) | [ ] Реализовано / [ ] Частично / [ ] Не реализовано |
4 | Регистрация событий (РСБ) | [ ] Реализовано / [ ] Частично / [ ] Не реализовано |
5 | Антивирусная защита (АВЗ) | [ ] Реализовано / [ ] Частично / [ ] Не реализовано |
6 | Обнаружение вторжений (СОВ) | [ ] Реализовано / [ ] Частично / [ ] Не реализовано |
7 | Контроль защищённости (АНЗ) | [ ] Реализовано / [ ] Частично / [ ] Не реализовано |
8 | Обеспечение целостности (ОЦЛ) | [ ] Реализовано / [ ] Частично / [ ] Не реализовано |
9 | Обеспечение доступности (ОДТ) | [ ] Реализовано / [ ] Частично / [ ] Не реализовано |
10 | Защита среды виртуализации (ЗСВ) | [ ] Реализовано / [ ] Частично / [ ] Не реализовано |
11 | Защита информационной системы (ЗИС) | [ ] Реализовано / [ ] Частично / [ ] Не реализовано |

4. ВЫЯВЛЕННЫЕ НЕДОСТАТКИ

№ | Недостаток | Рекомендация | Срок устранения
--|-----------|--------------|----------------
  |           |              |

5. ЗАКЛЮЧЕНИЕ

Комиссия РЕШИЛА:

[ ] Система защиты персональных данных ИСПДн «{{ispdn_name}}» соответствует требованиям Приказа ФСТЭК России № 21 и готова к вводу в эксплуатацию.

[ ] Система защиты персональных данных требует доработки. Ввод в эксплуатацию отложить до устранения выявленных недостатков.

Подписи членов комиссии:

Председатель:  _________________ / {{commission_chair}} /
Член комиссии: _________________ / _________________ /
Член комиссии: _________________ / _________________ /
Член комиссии: _________________ / _________________ /

Дата: «____» _____________ 202__ г.
""",
    },

    # ============ ПРИКАЗ № 17 (GOVERNMENT IS) ============
    {
        "template_code": "FSTEC17_SECURITY_CLASS",
        "title": "Акт классификации государственной информационной системы",
        "title_en": "Government IS Classification Act",
        "document_type": "act",
        "framework": "fstec17",
        "requirement_ref": "Приказ ФСТЭК № 17 п. 14",
        "form_fields": [
            {"name": "org_name", "label": "Наименование органа", "type": "text", "required": True},
            {"name": "is_name", "label": "Наименование ИС", "type": "text", "required": True},
            {"name": "security_class", "label": "Класс защищённости", "type": "select", "required": True,
             "options": ["К1", "К2", "К3"]},
        ],
        "template_content": """
УТВЕРЖДАЮ
Руководитель
{{org_name}}
_________________ / ___________________ /
«____» _____________ 202__ г.

АКТ
классификации государственной информационной системы
«{{is_name}}»

Комиссия в составе:
Председатель: _________________________
Члены комиссии:
- _________________________
- _________________________

провела классификацию государственной информационной системы «{{is_name}}».

1. СВЕДЕНИЯ ОБ ИНФОРМАЦИОННОЙ СИСТЕМЕ

1.1. Наименование: {{is_name}}
1.2. Оператор: {{org_name}}
1.3. Назначение: _________________________

2. ОПРЕДЕЛЕНИЕ УРОВНЯ ЗНАЧИМОСТИ ИНФОРМАЦИИ

2.1. Степень возможного ущерба:

Вид ущерба | Степень ущерба
-----------|---------------
Ущерб обороне и безопасности | [ ] Высокая / [ ] Средняя / [ ] Низкая / [ ] Нет
Ущерб внешнеполитическим интересам | [ ] Высокая / [ ] Средняя / [ ] Низкая / [ ] Нет
Ущерб экономике | [ ] Высокая / [ ] Средняя / [ ] Низкая / [ ] Нет
Ущерб социальной сфере | [ ] Высокая / [ ] Средняя / [ ] Низкая / [ ] Нет
Ущерб правам и свободам граждан | [ ] Высокая / [ ] Средняя / [ ] Низкая / [ ] Нет

2.2. Уровень значимости информации (УЗ):
[ ] УЗ 1 (высокий)
[ ] УЗ 2 (средний)
[ ] УЗ 3 (низкий)

3. ОПРЕДЕЛЕНИЕ МАСШТАБА ИНФОРМАЦИОННОЙ СИСТЕМЫ

[ ] Федеральный — ИС функционирует на территории РФ или нескольких субъектов
[ ] Региональный — ИС функционирует на территории субъекта РФ
[ ] Объектовый — ИС функционирует на объектах одного органа

4. ОПРЕДЕЛЕНИЕ КЛАССА ЗАЩИЩЁННОСТИ

На основании уровня значимости информации (УЗ) и масштаба ИС определён класс защищённости:

УЗ \\ Масштаб | Федеральный | Региональный | Объектовый
--------------|-------------|--------------|------------
УЗ 1          | К1          | К1           | К1
УЗ 2          | К1          | К2           | К2
УЗ 3          | К2          | К3           | К3

КЛАСС ЗАЩИЩЁННОСТИ: {{security_class}}

5. ЗАКЛЮЧЕНИЕ

Государственной информационной системе «{{is_name}}» присвоен класс защищённости {{security_class}}.

Подписи членов комиссии:

Председатель:  _________________ / _________________ /
Член комиссии: _________________ / _________________ /
Член комиссии: _________________ / _________________ /

Дата: «____» _____________ 202__ г.
""",
    },

    # ============ ПРИКАЗ № 239 (KII) ============
    {
        "template_code": "FSTEC239_SECURITY_REQUIREMENTS",
        "title": "Требования по обеспечению безопасности значимого объекта КИИ",
        "title_en": "Security Requirements for Significant KII Object",
        "document_type": "requirements",
        "framework": "fstec239",
        "requirement_ref": "Приказ ФСТЭК № 239",
        "form_fields": [
            {"name": "company_name", "label": "Наименование организации", "type": "text", "required": True},
            {"name": "object_name", "label": "Наименование объекта КИИ", "type": "text", "required": True},
            {"name": "category", "label": "Категория значимости", "type": "select", "required": True,
             "options": ["1 категория", "2 категория", "3 категория"]},
        ],
        "template_content": """
УТВЕРЖДАЮ
Генеральный директор
{{company_name}}
_________________ / ___________________ /
«____» _____________ 202__ г.

ТРЕБОВАНИЯ
по обеспечению безопасности значимого объекта
критической информационной инфраструктуры
«{{object_name}}»

Категория значимости: {{category}}

1. ОБЩИЕ ПОЛОЖЕНИЯ

1.1. Настоящие Требования разработаны в соответствии с Приказом ФСТЭК России от 25.12.2017 № 239.

1.2. Требования определяют состав мер по обеспечению безопасности значимого объекта КИИ.

2. БАЗОВЫЙ НАБОР МЕР ЗАЩИТЫ ДЛЯ {{category}}

2.1. Идентификация и аутентификация (ИАФ):
- ИАФ.1 — Идентификация и аутентификация пользователей
- ИАФ.3 — Управление идентификаторами
- ИАФ.4 — Управление средствами аутентификации
- ИАФ.5 — Защита обратной связи при вводе аутентификации

2.2. Управление доступом (УПД):
- УПД.1 — Управление учётными записями
- УПД.2 — Реализация методов управления доступом
- УПД.4 — Разделение полномочий пользователей
- УПД.5 — Назначение минимальных привилегий
- УПД.6 — Ограничение неуспешных попыток входа

2.3. Ограничение программной среды (ОПС):
- ОПС.1 — Управление запуском программ
- ОПС.2 — Управление установкой программ

2.4. Защита машинных носителей (ЗНИ):
- ЗНИ.1 — Учёт машинных носителей
- ЗНИ.2 — Управление доступом к носителям
- ЗНИ.8 — Уничтожение информации на носителях

2.5. Аудит безопасности (АУД):
- АУД.1 — Определение событий аудита
- АУД.2 — Определение состава информации
- АУД.3 — Сбор и хранение информации о событиях
- АУД.4 — Мониторинг событий безопасности

2.6. Антивирусная защита (АВЗ):
- АВЗ.1 — Реализация антивирусной защиты
- АВЗ.2 — Обновление баз данных

2.7. Предотвращение вторжений (СОВ):
- СОВ.1 — Обнаружение и предотвращение вторжений
- СОВ.2 — Обновление базы решающих правил

2.8. Обеспечение целостности (ОЦЛ):
- ОЦЛ.1 — Контроль целостности ПО и СЗИ
- ОЦЛ.3 — Обеспечение восстановления ПО и СЗИ

2.9. Обеспечение доступности (ОДТ):
- ОДТ.4 — Периодическое резервное копирование
- ОДТ.5 — Обеспечение восстановления информации

2.10. Защита информационной системы (ЗИС):
- ЗИС.2 — Защита при взаимодействии с внешними системами
- ЗИС.17 — Защита периметра

2.11. Реагирование на инциденты (ИНЦ):
- ИНЦ.1 — Выявление компьютерных инцидентов
- ИНЦ.2 — Информирование о компьютерных инцидентах
- ИНЦ.3 — Анализ компьютерных инцидентов
- ИНЦ.5 — Принятие мер по предотвращению повторов

2.12. Управление конфигурацией (УКФ):
- УКФ.1 — Идентификация объектов управления
- УКФ.2 — Управление изменениями

3. ДОПОЛНИТЕЛЬНЫЕ МЕРЫ ДЛЯ {{category}}

[Заполняется в соответствии с моделью угроз]

4. СРОКИ РЕАЛИЗАЦИИ

№ | Группа мер | Срок реализации | Ответственный
--|-----------|-----------------|---------------
1 | ИАФ | |
2 | УПД | |
3 | ОПС | |
4 | ЗНИ | |
5 | АУД | |
6 | АВЗ | |
7 | СОВ | |
8 | ОЦЛ | |
9 | ОДТ | |
10 | ЗИС | |
11 | ИНЦ | |
12 | УКФ | |

Ответственный за обеспечение безопасности КИИ: _________________ / _________________ /
""",
    },

    # ============ ADDITIONAL TEMPLATES ============
    {
        "template_code": "FSTEC_ADMIN_INSTRUCTION",
        "title": "Инструкция администратора безопасности",
        "title_en": "Security Administrator Instruction",
        "document_type": "instruction",
        "framework": "fstec",
        "requirement_ref": "Приказы ФСТЭК № 17, 21, 239",
        "form_fields": [
            {"name": "company_name", "label": "Наименование организации", "type": "text", "required": True},
            {"name": "system_name", "label": "Наименование системы", "type": "text", "required": True},
        ],
        "template_content": """
УТВЕРЖДАЮ
Генеральный директор
{{company_name}}
_________________ / ___________________ /
«____» _____________ 202__ г.

ИНСТРУКЦИЯ
администратора безопасности
информационной системы «{{system_name}}»

1. ОБЩИЕ ПОЛОЖЕНИЯ

1.1. Настоящая Инструкция определяет обязанности, права и ответственность администратора безопасности.

1.2. Администратор безопасности назначается приказом руководителя организации.

1.3. Администратор безопасности подчиняется ответственному за защиту информации.

2. КВАЛИФИКАЦИОННЫЕ ТРЕБОВАНИЯ

2.1. Образование: высшее техническое или переподготовка по ИБ.
2.2. Знания:
- законодательства РФ в области защиты информации;
- нормативных документов ФСТЭК и ФСБ;
- принципов построения систем защиты;
- применяемых средств защиты информации.

3. ОБЯЗАННОСТИ

3.1. Администратор безопасности ОБЯЗАН:

3.1.1. Ежедневно:
- проверять работоспособность средств защиты информации;
- анализировать журналы событий безопасности;
- контролировать состояние антивирусной защиты;
- реагировать на инциденты безопасности.

3.1.2. Еженедельно:
- проверять актуальность баз антивирусных средств;
- анализировать результаты сканирования уязвимостей;
- проверять целостность программного обеспечения.

3.1.3. Ежемесячно:
- проводить аудит прав доступа пользователей;
- проверять наличие неиспользуемых учётных записей;
- формировать отчёт о состоянии защищённости.

3.1.4. Ежеквартально:
- проводить тестирование резервного копирования;
- актуализировать документацию по ИБ;
- проводить инструктаж пользователей.

3.1.5. Ежегодно:
- участвовать в проведении аудита ИБ;
- проходить повышение квалификации.

4. ПРАВА

4.1. Администратор безопасности ИМЕЕТ ПРАВО:

4.1.1. Требовать от пользователей соблюдения политики ИБ.
4.1.2. Блокировать учётные записи при нарушении требований ИБ.
4.1.3. Инициировать расследование инцидентов.
4.1.4. Вносить предложения по совершенствованию системы защиты.
4.1.5. Получать необходимую информацию от подразделений.

5. ОТВЕТСТВЕННОСТЬ

5.1. Администратор безопасности НЕСЁТ ОТВЕТСТВЕННОСТЬ за:

5.1.1. Неисполнение или ненадлежащее исполнение обязанностей.
5.1.2. Разглашение конфиденциальной информации.
5.1.3. Нарушение требований политики ИБ.
5.1.4. Причинение ущерба в результате бездействия.

6. ПОРЯДОК ДЕЙСТВИЙ ПРИ ИНЦИДЕНТАХ

6.1. При обнаружении инцидента:
1) Зафиксировать факт инцидента.
2) Оценить критичность.
3) Принять меры по локализации.
4) Уведомить ответственного за защиту информации.
5) Провести расследование.
6) Оформить документацию.

7. ВЗАИМОДЕЙСТВИЕ

7.1. Администратор безопасности взаимодействует с:
- ответственным за защиту информации — по вопросам ИБ;
- системными администраторами — по техническим вопросам;
- пользователями — по вопросам доступа и инцидентов.

С инструкцией ознакомлен:

Администратор безопасности: _________________ / _________________ /
Дата: «____» _____________ 202__ г.
""",
    },
    {
        "template_code": "FSTEC_USER_INSTRUCTION",
        "title": "Инструкция пользователя по информационной безопасности",
        "title_en": "User Information Security Instruction",
        "document_type": "instruction",
        "framework": "fstec",
        "requirement_ref": "Приказы ФСТЭК № 17, 21, 239",
        "form_fields": [
            {"name": "company_name", "label": "Наименование организации", "type": "text", "required": True},
        ],
        "template_content": """
УТВЕРЖДАЮ
Генеральный директор
{{company_name}}
_________________ / ___________________ /
«____» _____________ 202__ г.

ИНСТРУКЦИЯ
пользователя по информационной безопасности
{{company_name}}

1. ОБЩИЕ ПОЛОЖЕНИЯ

1.1. Настоящая Инструкция обязательна для всех работников {{company_name}}, имеющих доступ к информационным системам.

1.2. Незнание требований Инструкции не освобождает от ответственности за их нарушение.

2. ПРАВИЛА РАБОТЫ С ПАРОЛЯМИ

2.1. Пароль должен:
- содержать не менее 8 символов;
- включать буквы, цифры и специальные символы;
- быть уникальным (не использоваться в других системах);
- храниться в тайне.

2.2. ЗАПРЕЩАЕТСЯ:
- сообщать пароль другим лицам;
- записывать пароль на бумаге или в файле;
- использовать простые пароли (даты, имена, словарные слова);
- использовать один пароль для разных систем.

2.3. Пароль подлежит немедленной смене при подозрении на компрометацию.

3. ПРАВИЛА РАБОТЫ С КОМПЬЮТЕРОМ

3.1. При работе с компьютером НЕОБХОДИМО:
- блокировать компьютер при отходе от рабочего места (Win+L);
- завершать сеанс работы по окончании рабочего дня;
- сохранять данные только в разрешённых местах.

3.2. ЗАПРЕЩАЕТСЯ:
- устанавливать программы без разрешения администратора;
- отключать антивирусную защиту;
- подключать личные устройства без разрешения;
- копировать конфиденциальную информацию на личные носители.

4. ПРАВИЛА РАБОТЫ С ЭЛЕКТРОННОЙ ПОЧТОЙ

4.1. ЗАПРЕЩАЕТСЯ:
- открывать вложения от неизвестных отправителей;
- переходить по ссылкам в подозрительных письмах;
- отправлять конфиденциальную информацию по незащищённым каналам;
- использовать рабочую почту для личных целей.

4.2. При получении подозрительного письма — сообщить администратору безопасности.

5. ПРАВИЛА РАБОТЫ С ИНТЕРНЕТОМ

5.1. ЗАПРЕЩАЕТСЯ:
- посещать сайты, не связанные с работой;
- скачивать файлы с непроверенных источников;
- использовать анонимайзеры и VPN без разрешения;
- размещать конфиденциальную информацию в Интернете.

6. ПРАВИЛА РАБОТЫ С НОСИТЕЛЯМИ ИНФОРМАЦИИ

6.1. Съёмные носители (флешки, диски):
- использовать только учтённые носители;
- проверять на вирусы перед использованием;
- хранить в защищённом месте;
- сдавать при увольнении.

6.2. ЗАПРЕЩАЕТСЯ:
- использовать личные носители;
- выносить носители с конфиденциальной информацией без разрешения.

7. ПРАВИЛА ОБРАЩЕНИЯ С КОНФИДЕНЦИАЛЬНОЙ ИНФОРМАЦИЕЙ

7.1. К конфиденциальной информации относятся:
- персональные данные;
- коммерческая тайна;
- служебная информация.

7.2. ЗАПРЕЩАЕТСЯ:
- разглашать конфиденциальную информацию;
- обсуждать рабочие вопросы в общественных местах;
- оставлять документы без присмотра.

8. ДЕЙСТВИЯ ПРИ ИНЦИДЕНТАХ

8.1. При обнаружении признаков инцидента (вирус, взлом, утечка):
1) Прекратить работу.
2) НЕ выключать компьютер.
3) Немедленно сообщить администратору безопасности.
4) Следовать указаниям администратора.

8.2. Контакт администратора безопасности: _______________

9. ОТВЕТСТВЕННОСТЬ

9.1. За нарушение требований настоящей Инструкции работник несёт дисциплинарную, административную или уголовную ответственность в соответствии с законодательством РФ.

С инструкцией ознакомлен:

_________________ / _________________ / «____» _____________ 202__ г.
""",
    },
    {
        "template_code": "FSTEC_VULNERABILITY_REPORT",
        "title": "Отчёт о сканировании уязвимостей",
        "title_en": "Vulnerability Scan Report",
        "document_type": "report",
        "framework": "fstec",
        "requirement_ref": "Приказы ФСТЭК № 17, 21, 239 (АНЗ.1)",
        "form_fields": [
            {"name": "company_name", "label": "Наименование организации", "type": "text", "required": True},
            {"name": "system_name", "label": "Наименование системы", "type": "text", "required": True},
            {"name": "scan_date", "label": "Дата сканирования", "type": "date", "required": True},
            {"name": "scanner_name", "label": "Используемый сканер", "type": "text", "required": True},
        ],
        "template_content": """
{{company_name}}

ОТЧЁТ
о сканировании уязвимостей
информационной системы «{{system_name}}»

Дата сканирования: {{scan_date}}
Используемый сканер: {{scanner_name}}

1. ОБЛАСТЬ СКАНИРОВАНИЯ

1.1. Проверенные узлы:

№ | IP-адрес | Hostname | ОС | Статус
--|----------|----------|-----|-------
1 | | | |
2 | | | |
3 | | | |

1.2. Типы проверок:
[ ] Сетевые уязвимости
[ ] Уязвимости ОС
[ ] Уязвимости веб-приложений
[ ] Уязвимости СУБД
[ ] Конфигурационные ошибки

2. СВОДКА РЕЗУЛЬТАТОВ

Критичность | Количество
------------|------------
Критическая |
Высокая |
Средняя |
Низкая |
Информационная |
ИТОГО |

3. КРИТИЧЕСКИЕ УЯЗВИМОСТИ

№ | CVE | Описание | Узел | CVSS | Рекомендация
--|-----|----------|------|------|-------------
1 | | | | |
2 | | | | |

4. ВЫСОКИЕ УЯЗВИМОСТИ

№ | CVE | Описание | Узел | CVSS | Рекомендация
--|-----|----------|------|------|-------------
1 | | | | |
2 | | | | |

5. СРЕДНИЕ И НИЗКИЕ УЯЗВИМОСТИ

[Сводная таблица или ссылка на детальный отчёт сканера]

6. РЕКОМЕНДАЦИИ

6.1. Немедленные действия (для критических уязвимостей):
- _________________________
- _________________________

6.2. Краткосрочные действия (1-2 недели):
- _________________________
- _________________________

6.3. Плановые действия (1 месяц):
- _________________________
- _________________________

7. ПЛАН УСТРАНЕНИЯ

№ | Уязвимость | Действие | Срок | Ответственный | Статус
--|-----------|----------|------|---------------|-------
1 | | | | |
2 | | | | |

8. ВЫВОДЫ

8.1. Общий уровень защищённости: [ ] Высокий / [ ] Средний / [ ] Низкий

8.2. Требуется повторное сканирование: [ ] Да / [ ] Нет

8.3. Дата следующего сканирования: _________________________

Отчёт подготовил: _________________ / _________________ /
Дата: «____» _____________ 202__ г.
""",
    },
]


def get_fstec_templates() -> list[dict[str, Any]]:
    """Return all FSTEC document templates."""
    return TEMPLATES_FSTEC


def get_security_measures() -> dict[str, Any]:
    """Return the security measures catalog."""
    return SECURITY_MEASURES


def get_measures_for_level(protection_level: str) -> list[dict[str, Any]]:
    """Get applicable security measures for a given protection level."""
    applicable = []
    for category_code, category in SECURITY_MEASURES.items():
        for measure in category["measures"]:
            if protection_level in measure["levels"]:
                applicable.append({
                    "category": category["name"],
                    "code": measure["code"],
                    "name": measure["name"],
                })
    return applicable
